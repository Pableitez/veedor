// ========================================
// VEEDOR ULTRA SIMPLE - VERSI√ìN GARANTIZADA
// ========================================

console.log('üöÄ VEEDOR ULTRA SIMPLE INICIANDO...');

// Datos est√°ticos garantizados
const DEMO_DATA = {
    balance: 1525.00,
    income: 3000.00,
    expenses: 1675.00,
    savings: 1325.00,
    netWorth: 45230.00,
    totalAssets: 52180.00,
    totalLiabilities: 6950.00,
    monthlyChange: 2150.00
};

// Funci√≥n para actualizar resumen financiero
function updateFinancialSummary() {
    console.log('üí∞ Actualizando resumen financiero...');
    
    const elements = {
        balance: document.querySelector('.balance-amount'),
        income: document.querySelector('.income-amount'),
        expenses: document.querySelector('.expenses-amount'),
        savings: document.querySelector('.savings-amount')
    };
    
    if (elements.balance) {
        elements.balance.textContent = `‚Ç¨${DEMO_DATA.balance.toLocaleString()}`;
        console.log('‚úÖ Balance actualizado');
    } else {
        console.log('‚ùå Elemento balance-amount no encontrado');
    }
    
    if (elements.income) {
        elements.income.textContent = `‚Ç¨${DEMO_DATA.income.toLocaleString()}`;
        console.log('‚úÖ Ingresos actualizados');
    } else {
        console.log('‚ùå Elemento income-amount no encontrado');
    }
    
    if (elements.expenses) {
        elements.expenses.textContent = `‚Ç¨${DEMO_DATA.expenses.toLocaleString()}`;
        console.log('‚úÖ Gastos actualizados');
    } else {
        console.log('‚ùå Elemento expenses-amount no encontrado');
    }
    
    if (elements.savings) {
        elements.savings.textContent = `‚Ç¨${DEMO_DATA.savings.toLocaleString()}`;
        console.log('‚úÖ Ahorro actualizado');
    } else {
        console.log('‚ùå Elemento savings-amount no encontrado');
    }
}

// Funci√≥n para actualizar patrimonio neto
function updateNetWorth() {
    console.log('üè† Actualizando patrimonio neto...');
    
    const elements = {
        netWorth: document.getElementById('net-worth-value'),
        netWorthChange: document.getElementById('net-worth-change'),
        totalAssets: document.getElementById('total-assets'),
        totalLiabilities: document.getElementById('total-liabilities')
    };
    
    if (elements.netWorth) {
        elements.netWorth.textContent = `‚Ç¨${DEMO_DATA.netWorth.toLocaleString()}`;
        console.log('‚úÖ Patrimonio neto actualizado');
    } else {
        console.log('‚ùå Elemento net-worth-value no encontrado');
    }
    
    if (elements.netWorthChange) {
        elements.netWorthChange.textContent = `+‚Ç¨${DEMO_DATA.monthlyChange.toLocaleString()} este mes`;
        console.log('‚úÖ Cambio mensual actualizado');
    } else {
        console.log('‚ùå Elemento net-worth-change no encontrado');
    }
    
    if (elements.totalAssets) {
        elements.totalAssets.textContent = `‚Ç¨${DEMO_DATA.totalAssets.toLocaleString()}`;
        console.log('‚úÖ Total activos actualizado');
    } else {
        console.log('‚ùå Elemento total-assets no encontrado');
    }
    
    if (elements.totalLiabilities) {
        elements.totalLiabilities.textContent = `‚Ç¨${DEMO_DATA.totalLiabilities.toLocaleString()}`;
        console.log('‚úÖ Total pasivos actualizado');
    } else {
        console.log('‚ùå Elemento total-liabilities no encontrado');
    }
}

// Funci√≥n para actualizar transacciones recientes
function updateRecentTransactions() {
    console.log('üìù Actualizando transacciones recientes...');
    
    const container = document.querySelector('.recent-transactions');
    if (!container) {
        console.log('‚ùå Container recent-transactions no encontrado');
        return;
    }

    const transactions = [
        { description: 'Salario mensual', category: 'Salario', amount: 3000, type: 'income' },
        { description: 'Alquiler', category: 'Vivienda', amount: 800, type: 'expense' },
        { description: 'Supermercado', category: 'Alimentaci√≥n', amount: 300, type: 'expense' },
        { description: 'Gasolina', category: 'Transporte', amount: 150, type: 'expense' },
        { description: 'Restaurante', category: 'Alimentaci√≥n', amount: 200, type: 'expense' }
    ];

    container.innerHTML = transactions.map(transaction => `
        <div class="transaction-item">
            <div class="transaction-info">
                <span class="transaction-description">${transaction.description}</span>
                <span class="transaction-category">${transaction.category}</span>
            </div>
            <div class="transaction-amount ${transaction.type}">
                ${transaction.type === 'income' ? '+' : '-'}‚Ç¨${transaction.amount.toFixed(2)}
            </div>
        </div>
    `).join('');
    
    console.log('‚úÖ Transacciones recientes actualizadas');
}

// Funci√≥n para crear gr√°fica de categor√≠as
function createCategoryChart() {
    console.log('üìä Creando gr√°fica de categor√≠as...');
    
    const canvas = document.getElementById('overviewCategoryChart');
    if (!canvas) {
        console.log('‚ùå Canvas overviewCategoryChart no encontrado');
        return;
    }

    if (typeof Chart === 'undefined') {
        console.log('‚ùå Chart.js no disponible');
        return;
    }

    // Destruir gr√°fico existente si existe
    if (window.overviewCategoryChart && typeof window.overviewCategoryChart.destroy === 'function') {
        window.overviewCategoryChart.destroy();
    }

    try {
        window.overviewCategoryChart = new Chart(canvas, {
            type: 'doughnut',
            data: {
                labels: ['Vivienda', 'Alimentaci√≥n', 'Transporte', 'Entretenimiento', 'Salud'],
                datasets: [{
                    data: [800, 500, 200, 100, 75],
                    backgroundColor: ['#8B5CF6', '#3B82F6', '#10B981', '#F59E0B', '#EF4444'],
                    borderWidth: 0,
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            usePointStyle: true,
                            padding: 20,
                            font: {
                                family: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
                                size: 12
                            }
                        }
                    }
                },
                cutout: '60%',
                animation: {
                    animateRotate: true,
                    duration: 1000,
                    easing: 'easeOutQuart'
                }
            }
        });
        console.log('‚úÖ Gr√°fica de categor√≠as creada exitosamente');
    } catch (error) {
        console.error('‚ùå Error creando gr√°fica de categor√≠as:', error);
    }
}

// Funci√≥n para crear gr√°fica de tendencias
function createTrendsChart() {
    console.log('üìà Creando gr√°fica de tendencias...');
    
    const canvas = document.getElementById('overviewTrendsChart');
    if (!canvas) {
        console.log('‚ùå Canvas overviewTrendsChart no encontrado');
        return;
    }

    if (typeof Chart === 'undefined') {
        console.log('‚ùå Chart.js no disponible');
        return;
    }

    // Destruir gr√°fico existente si existe
    if (window.overviewTrendsChart && typeof window.overviewTrendsChart.destroy === 'function') {
        window.overviewTrendsChart.destroy();
    }

    try {
        window.overviewTrendsChart = new Chart(canvas, {
            type: 'line',
            data: {
                labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
                datasets: [{
                    label: 'Ingresos',
                    data: [2800, 3000, 3200, 3000, 3100, 3000],
                    borderColor: '#10B981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }, {
                    label: 'Gastos',
                    data: [1200, 1350, 1400, 1300, 1450, 1675],
                    borderColor: '#EF4444',
                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            usePointStyle: true,
                            padding: 20,
                            font: {
                                family: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
                                size: 12
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            callback: function(value) {
                                return '‚Ç¨' + value.toFixed(0);
                            }
                        }
                    },
                    x: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    }
                },
                animation: {
                    duration: 1000,
                    easing: 'easeOutQuart'
                }
            }
        });
        console.log('‚úÖ Gr√°fica de tendencias creada exitosamente');
    } catch (error) {
        console.error('‚ùå Error creando gr√°fica de tendencias:', error);
    }
}

// Funci√≥n para crear gr√°fica de resumen financiero
function createIncomeExpensesChart() {
    console.log('üìä Creando gr√°fica de resumen financiero...');
    
    const canvas = document.getElementById('overviewIncomeExpensesChart');
    if (!canvas) {
        console.log('‚ùå Canvas overviewIncomeExpensesChart no encontrado');
        return;
    }

    if (typeof Chart === 'undefined') {
        console.log('‚ùå Chart.js no disponible');
        return;
    }

    // Destruir gr√°fico existente si existe
    if (window.overviewIncomeExpensesChart && typeof window.overviewIncomeExpensesChart.destroy === 'function') {
        window.overviewIncomeExpensesChart.destroy();
    }

    try {
        window.overviewIncomeExpensesChart = new Chart(canvas, {
            type: 'bar',
            data: {
                labels: ['Ingresos', 'Gastos', 'Ahorro'],
                datasets: [{
                    data: [3000, 1675, 1325],
                    backgroundColor: [
                        'rgba(16, 185, 129, 0.8)',
                        'rgba(239, 68, 68, 0.8)',
                        'rgba(59, 130, 246, 0.8)'
                    ],
                    borderColor: [
                        '#10B981',
                        '#EF4444',
                        '#3B82F6'
                    ],
                    borderWidth: 2,
                    borderRadius: 8,
                    borderSkipped: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            callback: function(value) {
                                return '‚Ç¨' + value.toFixed(0);
                            }
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                },
                animation: {
                    duration: 1000,
                    easing: 'easeOutQuart'
                }
            }
        });
        console.log('‚úÖ Gr√°fica de resumen financiero creada exitosamente');
    } catch (error) {
        console.error('‚ùå Error creando gr√°fica de resumen financiero:', error);
    }
}

// Funci√≥n para cambiar pesta√±as
function showTab(tabName) {
    console.log('üîÑ Cambiando a pesta√±a:', tabName);
    
    // Ocultar todas las pesta√±as
    document.querySelectorAll('.tab-panel').forEach(tab => {
        tab.classList.remove('active');
    });

    // Remover clase active de todos los botones
    document.querySelectorAll('.nav-tab').forEach(btn => {
        btn.classList.remove('active');
    });

    // Mostrar pesta√±a seleccionada
    const selectedTab = document.getElementById(tabName);
    const selectedBtn = document.querySelector(`[data-tab="${tabName}"]`);

    if (selectedTab) {
        selectedTab.classList.add('active');
        console.log('‚úÖ Pesta√±a activada:', selectedTab.id);
    } else {
        console.log('‚ùå Pesta√±a no encontrada:', tabName);
    }
    
    if (selectedBtn) {
        selectedBtn.classList.add('active');
        console.log('‚úÖ Bot√≥n activado:', selectedBtn);
    } else {
        console.log('‚ùå Bot√≥n no encontrado para:', tabName);
    }

    // Cargar contenido espec√≠fico de la pesta√±a
    if (tabName === 'overview') {
        updateFinancialSummary();
        updateRecentTransactions();
        updateNetWorth();
        createCategoryChart();
        createTrendsChart();
        createIncomeExpensesChart();
    }
}

// Funci√≥n para configurar event listeners
function setupEventListeners() {
    console.log('üîó Configurando event listeners...');
    
    // Event listeners para botones de navegaci√≥n
    document.querySelectorAll('.nav-tab').forEach(button => {
        const tabName = button.getAttribute('data-tab');
        if (tabName) {
            button.addEventListener('click', () => {
                console.log('üñ±Ô∏è Bot√≥n clickeado:', tabName);
                showTab(tabName);
            });
            console.log('‚úÖ Event listener agregado para:', tabName);
        }
    });
    
    console.log('‚úÖ Event listeners configurados');
}

// Funci√≥n de debug espec√≠fica para verificar duplicados
function checkDuplicates() {
    console.log('=== VERIFICANDO DUPLICADOS ===');
    
    const chartIds = [
        'overviewCategoryChart',
        'overviewTrendsChart', 
        'overviewIncomeExpensesChart'
    ];
    
    chartIds.forEach(id => {
        const elements = document.querySelectorAll(`#${id}`);
        console.log(`${id}:`, elements.length, 'elementos encontrados');
        
        if (elements.length > 1) {
            console.log('‚ùå DUPLICADO DETECTADO:', id);
            elements.forEach((el, index) => {
                console.log(`   Elemento ${index + 1}:`, el);
            });
        } else if (elements.length === 1) {
            console.log('‚úÖ Elemento √∫nico:', id);
        } else {
            console.log('‚ùå Elemento no encontrado:', id);
        }
    });
    
    // Verificar si Chart.js est√° creando m√∫ltiples instancias
    const charts = [
        'overviewCategoryChart',
        'overviewTrendsChart',
        'overviewIncomeExpensesChart'
    ];
    
    console.log('Gr√°ficas creadas en window:');
    charts.forEach(chartName => {
        const chart = window[chartName];
        console.log(`${chartName}:`, chart ? '‚úÖ Creada' : '‚ùå No creada');
        if (chart) {
            console.log(`   Tipo:`, chart.config.type);
            console.log(`   Datos:`, chart.data.datasets[0].data);
        }
    });
    
    console.log('=== VERIFICACI√ìN COMPLETADA ===');
}

// Funci√≥n principal de inicializaci√≥n
function initializeSystem() {
    console.log('=== INICIALIZANDO SISTEMA ULTRA SIMPLE ===');
    
    // 1. Actualizar datos
    updateFinancialSummary();
    updateRecentTransactions();
    updateNetWorth();
    
    // 2. Configurar navegaci√≥n
    setupEventListeners();
    
    // 3. Crear gr√°ficas si Chart.js est√° disponible
    if (typeof Chart !== 'undefined') {
        console.log('‚úÖ Chart.js disponible, creando gr√°ficas...');
        createCategoryChart();
        createTrendsChart();
        createIncomeExpensesChart();
    } else {
        console.log('‚ùå Chart.js no disponible');
    }
    
    console.log('=== SISTEMA INICIALIZADO ===');
}

// Hacer funciones globales
window.debugSystem = debugSystem;
window.checkDuplicates = checkDuplicates;
window.initializeSystem = initializeSystem;
window.showTab = showTab;
window.updateFinancialSummary = updateFinancialSummary;
window.updateNetWorth = updateNetWorth;
window.updateRecentTransactions = updateRecentTransactions;
window.createCategoryChart = createCategoryChart;
window.createTrendsChart = createTrendsChart;
window.createIncomeExpensesChart = createIncomeExpensesChart;
window.setupEventListeners = setupEventListeners;

// Inicializar autom√°ticamente
document.addEventListener('DOMContentLoaded', () => {
    console.log('=== DOM CARGADO ===');
    setTimeout(() => {
        initializeSystem();
    }, 100);
});

// Tambi√©n inicializar cuando la ventana se carga completamente
window.addEventListener('load', () => {
    console.log('=== VENTANA CARGADA COMPLETAMENTE ===');
    setTimeout(() => {
        console.log('Verificando componentes...');
        console.log('Chart.js:', typeof Chart !== 'undefined');
        
        if (typeof Chart !== 'undefined') {
            console.log('‚úÖ Chart.js disponible, forzando actualizaci√≥n...');
            createCategoryChart();
            createTrendsChart();
            createIncomeExpensesChart();
        } else {
            console.log('‚ùå Chart.js no disponible');
        }
    }, 500);
});

console.log('=== VEEDOR ULTRA SIMPLE CARGADO ===');
