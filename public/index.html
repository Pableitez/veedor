<!DOCTYPE html>
<html lang="es" data-default-lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Aplicaci√≥n completa para gestionar tus finanzas personales">
    <meta name="theme-color" content="#F8FAFC" id="themeColorMeta">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default" id="statusBarStyle">
    <meta name="apple-mobile-web-app-title" content="Veedor">
    <title>Veedor - Control de Finanzas Personales</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'%3E%3Cdefs%3E%3ClinearGradient id='vGradient' x1='0' y1='0' x2='192' y2='192' gradientUnits='userSpaceOnUse'%3E%3Cstop offset='0%25' stop-color='%23FF6B6B'/%3E%3Cstop offset='15%25' stop-color='%234ECDC4'/%3E%3Cstop offset='30%25' stop-color='%2345B7D1'/%3E%3Cstop offset='45%25' stop-color='%2396CEB4'/%3E%3Cstop offset='60%25' stop-color='%23FFEAA7'/%3E%3Cstop offset='75%25' stop-color='%23FDCB6E'/%3E%3Cstop offset='90%25' stop-color='%23E17055'/%3E%3Cstop offset='100%25' stop-color='%23FF6B6B'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='192' height='192' rx='40' fill='white'/%3E%3Ctext x='96' y='140' font-family='-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif' font-size='140' font-weight='800' text-anchor='middle' fill='url(%23vGradient)' letter-spacing='-4'%3EV%3C/text%3E%3C/svg%3E">
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="styles.css?v=2">
    <style>
        /* Asegurar margin-top: 0 para html y body */
        html {
            margin: 0 !important;
            margin-top: 0 !important;
        }
        body {
            margin: 0 !important;
            margin-top: 0 !important;
        }
        /* Ajustar padding superior en iOS para el status bar */
        @supports (-webkit-touch-callout: none) {
            body {
                padding-top: env(safe-area-inset-top);
            }
            #mainApp {
                padding-top: env(safe-area-inset-top);
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="translations.js"></script>
    <script>
        // Inicializar modo oscuro ANTES de que se renderice el body para evitar flash
        (function() {
            const savedMode = localStorage.getItem('veedor_darkMode');
            const themeColorMeta = document.getElementById('themeColorMeta');
            const statusBarStyle = document.getElementById('statusBarStyle');
            
            if (savedMode === null || savedMode === 'true') {
                document.documentElement.classList.add('dark-mode');
                // Actualizar theme-color para status bar (modo oscuro - color muy oscuro del inicio)
                if (themeColorMeta) {
                    themeColorMeta.setAttribute('content', '#050510');
                }
                // Actualizar status bar style (modo oscuro - contenido claro)
                if (statusBarStyle) {
                    statusBarStyle.setAttribute('content', 'black-translucent');
                }
                // Verificar que body existe antes de acceder a classList
                if (document.body) {
                    document.body.classList.add('dark-mode');
                } else {
                    // Si body no existe a√∫n, esperar a que se cargue
                    document.addEventListener('DOMContentLoaded', () => {
                        if (document.body) {
                            document.body.classList.add('dark-mode');
                        }
                    });
                }
            } else {
                // Modo claro - actualizar theme-color y status bar style
                if (themeColorMeta) {
                    themeColorMeta.setAttribute('content', '#F8FAFC');
                }
                if (statusBarStyle) {
                    statusBarStyle.setAttribute('content', 'default');
                }
            }
        })();
    </script>
</head>
<body>
    <!-- Pantalla de Login/Registro -->
    <div id="authScreen" class="auth-screen">
        <div class="auth-container" style="position: relative;">
            <!-- Bot√≥n de Toggle Modo Oscuro/Claro -->
            <!-- Contenedor de botones de configuraci√≥n en Welcome Page -->
            <div style="position: absolute; top: 20px; left: 20px; z-index: 10;">
                <!-- Bot√≥n de Instalaci√≥n PWA (peque√±o y discreto) -->
                <button id="installPWAButton" style="display: flex; padding: 6px 12px; background: rgba(78, 205, 196, 0.1); border: 1px solid rgba(78, 205, 196, 0.2); border-radius: 8px; color: #4ECDC4; font-size: 12px; font-weight: 500; cursor: pointer; transition: all 0.3s; align-items: center; gap: 6px; box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);" onmouseover="this.style.background='rgba(78, 205, 196, 0.2)'; this.style.borderColor='rgba(78, 205, 196, 0.4)'" onmouseout="this.style.background='rgba(78, 205, 196, 0.1)'; this.style.borderColor='rgba(78, 205, 196, 0.2)'" title="Instalar aplicaci√≥n">
                    Instalar
                </button>
            </div>
            <div style="position: absolute; top: 20px; right: 20px; z-index: 10; display: flex; align-items: center; gap: 12px;">
                <!-- Toggle Modo Oscuro/Claro -->
                <button id="authDarkModeToggle" onclick="toggleDarkMode(); updateAuthDarkModeIcon();" style="padding: 10px; background: rgba(78, 205, 196, 0.15); border: 1px solid rgba(78, 205, 196, 0.3); border-radius: 10px; color: #4ECDC4; font-size: 20px; font-weight: 500; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; width: 44px; height: 44px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);" onmouseover="this.style.background='rgba(78, 205, 196, 0.25)'; this.style.borderColor='rgba(78, 205, 196, 0.5)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(78, 205, 196, 0.15)'; this.style.borderColor='rgba(78, 205, 196, 0.3)'; this.style.transform='scale(1)'" title="Cambiar modo oscuro/claro">
                    <span id="authDarkModeIcon" style="font-size: 20px; filter: grayscale(100%);">üåô</span>
                        </button>
                        </div>
            <div class="auth-header">
                <h1 style="font-size: clamp(22px, 4vw, 36px); font-weight: 800; letter-spacing: -1px; margin: 0 0 clamp(6px, 1vh, 8px) 0; background: linear-gradient(90deg, #FF6B6B 0%, #4ECDC4 15%, #45B7D1 30%, #96CEB4 45%, #FFEAA7 60%, #FDCB6E 75%, #E17055 90%, #FF6B6B 100%); background-size: 300% 100%; -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; animation: rainbow-flow 20s ease-in-out infinite; transition: all 0.3s ease; filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));">Veedor</h1>
                <p style="font-size: clamp(12px, 1.8vw, 16px); color: var(--text-secondary); margin: 0; font-weight: 500; transition: all 0.3s ease;">La cuenta de la vieja, pero digital.</p>
            </div>
            
            <div class="auth-tabs">
                <button class="auth-tab-btn active" data-auth-tab="login" data-translate="auth.login">Iniciar Sesi√≥n</button>
                <button class="auth-tab-btn" data-auth-tab="register" data-translate="auth.register">Registrarse</button>
            </div>
            
            <!-- Formulario de Login -->
            <div id="loginForm" class="auth-form active">
                <form id="loginFormElement">
                    <div class="form-group">
                        <label for="loginEmailOrUsername" data-translate="auth.emailOrUsername">Email o Nombre de Usuario</label>
                        <input type="text" id="loginEmailOrUsername" required autocomplete="username" data-translate-placeholder="auth.emailOrUsername">
                        <small data-translate="auth.emailOrUsernameHint">Puedes usar tu email o tu nombre de usuario</small>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword" data-translate="auth.password">Contrase√±a</label>
                        <input type="password" id="loginPassword" required autocomplete="current-password" data-translate-placeholder="auth.password">
                    </div>
                    <button type="submit" class="btn-primary btn-full" data-translate="auth.login">Iniciar Sesi√≥n</button>
                    <p id="loginError" class="error-message"></p>
                    <p style="text-align: center; margin-top: clamp(12px, 2vh, 16px);">
                        <a href="#" id="forgotPasswordLink" style="color: var(--primary); text-decoration: none; font-size: clamp(12px, 1.8vw, 14px);" data-translate="auth.forgotPassword">¬øOlvidaste tu contrase√±a?</a>
                    </p>
                </form>
            </div>
            
            <!-- Formulario de Recuperaci√≥n de Contrase√±a -->
            <div id="forgotPasswordForm" class="auth-form" style="display: none;">
                <h3 style="margin-bottom: clamp(12px, 2vh, 16px); font-size: clamp(16px, 2.5vw, 20px); font-weight: 700;" data-translate="auth.recoverPassword">Recuperar Contrase√±a</h3>
                <form id="forgotPasswordFormElement">
                    <div class="form-group" style="margin-bottom: clamp(10px, 1.5vh, 14px);">
                        <label for="forgotEmail" data-translate="auth.email" style="font-size: clamp(11px, 1.5vw, 13px);">Email</label>
                        <input type="email" id="forgotEmail" required style="padding: clamp(8px, 1.2vh, 10px) clamp(10px, 1.5vw, 14px); font-size: clamp(12px, 1.8vw, 14px);">
                    </div>
                    <button type="submit" class="btn-primary btn-full" data-translate="auth.sendRecoveryLink" style="padding: clamp(10px, 1.5vh, 11px); font-size: clamp(12px, 1.8vw, 14px);">Enviar Enlace de Recuperaci√≥n</button>
                    <p id="forgotPasswordError" class="error-message" style="font-size: clamp(11px, 1.5vw, 12px); margin-top: clamp(8px, 1.2vh, 10px);"></p>
                    <p id="forgotPasswordSuccess" class="success-message" style="display: none; margin-top: clamp(8px, 1.2vh, 10px);"></p>
                </form>
                <div id="resetPasswordSection" style="display: none; margin-top: clamp(12px, 2vh, 16px); padding-top: clamp(12px, 2vh, 16px); border-top: 1px solid var(--gray-200);">
                    <h4 style="margin-bottom: clamp(10px, 1.5vh, 12px); font-size: clamp(13px, 2vw, 15px); font-weight: 600; color: var(--text-primary);" data-translate="auth.enterRecoveryCode">Ingresa el c√≥digo y nueva contrase√±a</h4>
                    <form id="resetPasswordFormElement">
                        <div class="form-group" style="margin-bottom: clamp(8px, 1.2vh, 10px);">
                            <label for="resetToken" data-translate="auth.recoveryCode" style="font-size: clamp(11px, 1.5vw, 12px);">C√≥digo</label>
                            <input type="text" id="resetToken" required data-translate-placeholder="auth.pasteRecoveryCode" placeholder="Pega el c√≥digo" style="padding: clamp(8px, 1.2vh, 9px) clamp(10px, 1.5vw, 12px); font-size: clamp(12px, 1.8vw, 13px);">
                        </div>
                        <div class="form-group" style="margin-bottom: clamp(10px, 1.5vh, 14px);">
                            <label for="resetNewPassword" data-translate="auth.newPassword" style="font-size: clamp(11px, 1.5vw, 12px);">Nueva Contrase√±a</label>
                            <input type="password" id="resetNewPassword" required minlength="4" style="padding: clamp(8px, 1.2vh, 9px) clamp(10px, 1.5vw, 12px); font-size: clamp(12px, 1.8vw, 13px);">
                        </div>
                        <button type="submit" class="btn-primary btn-full" data-translate="auth.resetPassword" style="padding: clamp(10px, 1.5vh, 11px); font-size: clamp(12px, 1.8vw, 14px); margin-top: clamp(2px, 0.5vh, 2px);">Restablecer Contrase√±a</button>
                        <p id="resetPasswordError" class="error-message" style="font-size: clamp(11px, 1.5vw, 12px); margin-top: clamp(6px, 1vh, 8px);"></p>
                    </form>
                </div>
                <p style="text-align: center; margin-top: clamp(12px, 2vh, 16px);">
                    <a href="#" id="backToLoginLink" style="color: var(--primary); text-decoration: none; font-size: clamp(11px, 1.5vw, 12px); font-weight: 500;" data-translate="auth.backToLogin">Volver a Iniciar Sesi√≥n</a>
                </p>
            </div>
            
            <!-- Formulario de Registro -->
            <div id="registerForm" class="auth-form" style="display: none;">
                <form id="registerFormElement">
                    <div class="form-group">
                        <label for="registerEmail" data-translate="auth.email">Email</label>
                        <input type="email" id="registerEmail" required autocomplete="email" data-translate-placeholder="auth.email">
                    </div>
                    <div class="form-group">
                        <label for="registerUsername" data-translate="auth.username">Nombre de Usuario</label>
                        <input type="text" id="registerUsername" required autocomplete="username" minlength="3" data-translate-placeholder="auth.username">
                        <small data-translate="auth.usernameHint">M√≠nimo 3 caracteres</small>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword" data-translate="auth.password">Contrase√±a</label>
                        <input type="password" id="registerPassword" required autocomplete="new-password" minlength="4" data-translate-placeholder="auth.password">
                        <small data-translate="auth.passwordHint">M√≠nimo 4 caracteres</small>
                    </div>
                    <div class="form-group">
                        <label for="registerPasswordConfirm" data-translate="auth.confirmPassword">Confirmar Contrase√±a</label>
                        <input type="password" id="registerPasswordConfirm" required autocomplete="new-password" data-translate-placeholder="auth.confirmPassword">
                    </div>
                    <button type="submit" class="btn-primary btn-full" data-translate="auth.register">Registrarse</button>
                    <p id="registerError" class="error-message"></p>
                </form>
            </div>
        </div>
    </div>

    <!-- Contenido Principal (oculto hasta login) -->
    <div id="mainApp" style="display: none; width: 100%; margin: 0; padding: 0; min-height: 100vh;">
        <header style="background: transparent; color: rgba(255,255,255,0.9); padding: 12px 24px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; box-shadow: none; border-bottom: none; width: 100%; box-sizing: border-box; margin: 0; left: 0; right: 0; border-radius: 0;" class="main-header">
            <div style="display: flex; align-items: center; gap: 12px; flex-shrink: 0;">
                <div style="display: flex; align-items: center; gap: 12px; flex-shrink: 0;">
                    <h1 style="margin: 0; font-size: 36px; font-weight: 800; letter-spacing: -1px; white-space: nowrap; background: linear-gradient(90deg, #FF6B6B 0%, #4ECDC4 15%, #45B7D1 30%, #96CEB4 45%, #FFEAA7 60%, #FDCB6E 75%, #E17055 90%, #FF6B6B 100%); background-size: 300% 100%; -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; animation: rainbow-flow 20s ease-in-out infinite; text-rendering: optimizeLegibility; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));">Veedor</h1>
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 12px; flex-shrink: 0; margin-left: auto;">
                <!-- Toggle Modo Oscuro/Claro -->
                <div style="position: relative; flex-shrink: 0; display: flex !important; visibility: visible !important;">
                    <button id="darkModeToggleBtn" onclick="toggleDarkMode(); updateNavDarkModeIcon();" style="padding: 8px; border-radius: 4px; font-size: 18px; font-weight: 500; cursor: pointer; transition: all 0.2s; display: flex !important; visibility: visible !important; opacity: 1 !important; align-items: center; justify-content: center; width: 36px; height: 36px; flex-shrink: 0; background: rgba(78, 205, 196, 0.15); border: 1px solid rgba(78, 205, 196, 0.3); color: #4ECDC4;" onmouseover="this.style.background='rgba(78, 205, 196, 0.25)'; this.style.borderColor='rgba(78, 205, 196, 0.5)'" onmouseout="this.style.background='rgba(78, 205, 196, 0.15)'; this.style.borderColor='rgba(78, 205, 196, 0.3)'" title="Cambiar modo oscuro/claro">
                        <span id="darkModeToggleIcon" style="filter: grayscale(100%);">üåô</span>
                    </button>
                        </div>
                <!-- Men√∫ de Usuario -->
                <div style="position: relative; flex-shrink: 0;">
                    <button id="settingsDropdownBtn" onclick="toggleSettingsDropdown();" style="padding: 8px; border-radius: 4px; font-size: 18px; font-weight: 500; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; width: 36px; height: 36px; flex-shrink: 0; background: rgba(78, 205, 196, 0.15); border: 1px solid rgba(78, 205, 196, 0.3); color: #4ECDC4;" onmouseover="this.style.background='rgba(78, 205, 196, 0.25)'; this.style.borderColor='rgba(78, 205, 196, 0.5)'" onmouseout="this.style.background='rgba(78, 205, 196, 0.15)'; this.style.borderColor='rgba(78, 205, 196, 0.3)'" title="Usuario">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="2" fill="none"/>
                            <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" stroke="currentColor" stroke-width="2" fill="none"/>
                        </svg>
                    </button>
                    <div id="settingsDropdown" style="display: none; position: absolute; top: 100%; right: 0; margin-top: 8px; background: var(--bg-primary); border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); min-width: 200px; max-width: calc(100vw - 24px); z-index: 1000; overflow: hidden; border: 1px solid var(--border-color); color: var(--text-primary);">
                        <a href="javascript:void(0);" onclick="showUserProfile(); toggleSettingsDropdown();" class="nav-dropdown-item" style="display: flex; align-items: center; gap: 8px;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="2" fill="none"/>
                                <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" stroke="currentColor" stroke-width="2" fill="none"/>
                            </svg>
                            <span id="currentUserText" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1;" data-translate="settings.user">Usuario</span>
                        </a>
                        <div style="border-top: 1px solid var(--border-color); margin-top: 4px; padding-top: 4px;">
                            <a href="javascript:void(0);" onclick="logout(); toggleSettingsDropdown();" class="nav-dropdown-item" style="color: var(--danger); display: flex; align-items: center; gap: 8px;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <polyline points="16 17 21 12 16 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <line x1="21" y1="12" x2="9" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                                <span data-translate="settings.logout">Salir</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Mensaje de bienvenida personalizado -->
        <div id="welcomeMessage" style="padding: 12px 24px; text-align: center; color: var(--text-secondary); font-size: 15px; font-weight: 500; opacity: 0.9; transition: opacity 0.3s ease; display: none;">
            <span id="welcomeMessageText"></span>
                </div>
                
        <div class="dashboard" style="margin-top: 0;">
                <!-- Card de Saldo - Estilo Revolut Transparente -->
                <div class="revolut-section" style="margin-bottom: 24px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <!-- Saldo en Cuentas -->
                        <div class="revolut-card" style="background: transparent; border: none; color: white; cursor: pointer; position: relative; overflow: visible; padding: 20px 24px; box-shadow: none;" onclick="showSummaryDetails('accounts')" title="Haz clic para ver detalles">
                            <div style="position: relative; z-index: 1; display: flex; flex-direction: column; height: 100%; justify-content: center; align-items: center; text-align: center; word-wrap: break-word; overflow-wrap: break-word; box-sizing: border-box;">
                                <h3 style="color: rgba(255,255,255,0.9); font-size: 11px; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; opacity: 0.95; word-wrap: break-word; overflow-wrap: break-word; max-width: 100%;">Saldo en Cuentas</h3>
                                <p class="amount" id="totalAccountsBalance" style="color: white; font-size: 56px; font-weight: 700; margin: 0; line-height: 1.1; letter-spacing: -0.5px; display: flex; align-items: center; justify-content: center; word-wrap: break-word; overflow-wrap: break-word; max-width: 100%;">0,00 ‚Ç¨</p>
                            </div>
                        </div>
                                    </div>
                                        </div>

        <div class="main-content" style="margin-top: 0;">
            <div class="tabs">
                <button class="tab-btn active" data-tab="transactions">
                    <span class="tab-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                            <line x1="1" y1="10" x2="23" y2="10"></line>
                        </svg>
                    </span>
                    <span class="tab-text" data-translate="nav.transactions">Transacciones</span>
                </button>
                <button class="tab-btn" data-tab="summary">
                    <span class="tab-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 3v18h18"></path>
                            <path d="M18 7l-5 5-4-4-3 3"></path>
                        </svg>
                    </span>
                    <span class="tab-text">Resumen</span>
                </button>
                <button class="tab-btn" data-tab="accounts">
                    <span class="tab-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                            <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                        </svg>
                    </span>
                    <span class="tab-text" data-translate="nav.accounts">Cuentas</span>
                </button>
                <button class="tab-btn" data-tab="envelopes">
                    <span class="tab-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="8" width="18" height="12" rx="2"></rect>
                            <path d="M3 10h18"></path>
                            <path d="M7 15h.01"></path>
                            <path d="M7 18h.01"></path>
                            <path d="M12 15h.01"></path>
                            <path d="M12 18h.01"></path>
                            <path d="M17 15h.01"></path>
                            <path d="M17 18h.01"></path>
                        </svg>
                    </span>
                    <span class="tab-text" data-translate="nav.budgets">Presupuestos</span>
                </button>
                <button class="tab-btn" data-tab="loans">
                    <span class="tab-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                    </span>
                    <span class="tab-text" data-translate="nav.loans">Pr√©stamos</span>
                </button>
                <button class="tab-btn" data-tab="investments">
                    <span class="tab-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                            <polyline points="17 6 23 6 23 12"></polyline>
                        </svg>
                    </span>
                    <span class="tab-text" data-translate="nav.investments">Inversiones</span>
                </button>
                <button class="tab-btn" data-tab="assets">
                    <span class="tab-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                            <polyline points="9 22 9 12 15 12 15 22"></polyline>
                        </svg>
                    </span>
                    <span class="tab-text" data-translate="nav.assets">Patrimonio</span>
                </button>
                <button class="tab-btn" data-tab="charts">
                    <span class="tab-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="20" x2="18" y2="10"></line>
                            <line x1="12" y1="20" x2="12" y2="4"></line>
                            <line x1="6" y1="20" x2="6" y2="14"></line>
                        </svg>
                    </span>
                    <span class="tab-text" data-translate="nav.analysis">An√°lisis</span>
                </button>
                </div>
                
            <!-- Tab: Resumen -->
            <div class="tab-content" id="summary-tab">
                <div style="margin-bottom: 32px;">
                    <h3 style="font-size: clamp(16px, 4vw, 18px); font-weight: 700; color: var(--text-primary); margin: 0 0 20px 0;">Vista de Resumen</h3>
                    
                    <div class="summary-cards">
                        <div class="card" style="cursor: pointer;" onclick="showSummaryDetails('balance')" title="Haz clic para ver detalles">
                            <h3>Balance Total</h3>
                            <p class="amount" id="totalBalance">0,00 ‚Ç¨</p>
                            <small id="totalBalancePeriod">Historial completo</small>
                        </div>
                        <div class="card" style="cursor: pointer;" onclick="showSummaryDetails('income')" data-translate-title="dashboard.clickForDetails" title="Haz clic para ver detalles">
                            <h3 id="periodIncomeLabel" data-translate="dashboard.income">Ingresos</h3>
                            <p class="amount positive" id="periodIncome">0,00 ‚Ç¨</p>
                            <small id="periodIncomeSubLabel" data-translate="dashboard.thisMonth">Este mes</small>
                        </div>
                        <div class="card" style="cursor: pointer;" onclick="showSummaryDetails('expenses')" data-translate-title="dashboard.clickForDetails" title="Haz clic para ver detalles">
                            <h3 id="periodExpensesLabel" data-translate="dashboard.expenses">Gastos</h3>
                            <p class="amount negative" id="periodExpenses">0,00 ‚Ç¨</p>
                            <small id="periodExpensesSubLabel" data-translate="dashboard.thisMonth">Este mes</small>
                        </div>
                        <div class="card" style="cursor: pointer;" onclick="showSummaryDetails('savings')" data-translate-title="dashboard.clickForDetails" title="Haz clic para ver detalles">
                            <h3 id="periodSavingsLabel" data-translate="dashboard.savings">Ahorro</h3>
                            <p class="amount" id="periodSavings">0,00 ‚Ç¨</p>
                            <small id="periodSavingsSubLabel" data-translate="dashboard.thisMonth">Este mes</small>
                        </div>
                    </div>
                </div>
                
                <!-- Selector de An√°lisis del Mes -->
                <div id="monthAnalysisSelector" style="background: var(--bg-primary); padding: 16px; border-radius: 8px; border: 1px solid var(--border-color); box-shadow: var(--shadow-light); margin-top: 32px; margin-bottom: 20px; display: none; width: 100%; box-sizing: border-box;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: var(--text-secondary); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;" data-translate="dashboard.monthAnalysis">An√°lisis del Mes</label>
                    <div style="position: relative; cursor: pointer; width: 100%; display: flex; align-items: center; justify-content: center; box-sizing: border-box;" onclick="document.getElementById('dashboardMonth').showPicker ? document.getElementById('dashboardMonth').showPicker() : document.getElementById('dashboardMonth').focus();">
                        <input type="month" id="dashboardMonth" style="width: 100%; padding: 10px 12px; border: 1.5px solid var(--border-color); border-radius: var(--radius); font-size: 14px; background: var(--bg-primary); color: var(--text-primary); cursor: pointer; transition: all 0.2s; pointer-events: auto; text-align: center; box-sizing: border-box;">
                    </div>
                    <small style="display: block; margin-top: 6px; font-size: 11px; color: var(--text-tertiary);" data-translate="dashboard.monthAnalysisHint">Selecciona un mes para ver el an√°lisis detallado</small>
                </div>
                
                <!-- An√°lisis del Mes Seleccionado -->
                <div id="monthDashboard" style="margin-top: 0; display: none;">
                    <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 20px; color: var(--text-primary);" data-translate="dashboard.selectedMonthAnalysis">An√°lisis del Mes Seleccionado</h3>
                    
                    <!-- Gastos por Categor√≠a -->
                    <div style="margin-bottom: 32px;">
                        <h4 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: var(--text-primary);" data-translate="dashboard.expensesByCategory">Gastos por Categor√≠a</h4>
                        <div id="monthExpensesByCategory" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px;">
                        </div>
                    </div>
                    
                    <!-- Ingresos por Categor√≠a -->
                    <div style="margin-bottom: 32px;">
                        <h4 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: var(--text-primary);" data-translate="dashboard.incomeByCategory">Ingresos por Categor√≠a</h4>
                        <div id="monthIncomeByCategory" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px;">
                        </div>
                    </div>
                    
                    <!-- Estado de Presupuestos del Mes -->
                    <div style="margin-bottom: 32px;">
                        <h4 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: var(--text-primary);" data-translate="dashboard.budgetsStatus">Estado de Presupuestos</h4>
                        <div id="monthBudgetsStatus" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px;">
                        </div>
                    </div>
                    
                    <!-- Estado de Sobres del Mes -->
                    <div style="margin-bottom: 32px;">
                        <h4 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: var(--text-primary);" data-translate="dashboard.envelopesStatus">Estado de Sobres</h4>
                        <div id="monthEnvelopesStatus" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px;">
                </div>
            </div>
        </div>

                <!-- Top Gastos del Per√≠odo -->
                <div class="table-section" style="margin-top: 32px;">
                    <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: var(--text-primary);">Top Gastos del Per√≠odo</h3>
                    <div class="table-container" style="max-height: 400px; overflow-y: auto;">
                        <table id="topExpensesTable">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Categor√≠a</th>
                                    <th>Descripci√≥n</th>
                                    <th>Monto</th>
                                </tr>
                            </thead>
                            <tbody id="topExpensesBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Tab: Transacciones -->
            <div class="tab-content active" id="transactions-tab">
                <div class="form-section">
                    <div style="display: flex; justify-content: flex-end; align-items: center; margin-bottom: 20px;">
                        <button type="button" class="btn-primary" id="toggleTransactionFormBtn" onclick="toggleForm('transactionForm', 'toggleTransactionFormBtn')" style="display: flex; align-items: center; gap: 8px;">
                            <span id="transactionFormText">Nueva Transacci√≥n</span>
                        </button>
                    </div>
                    <div style="background: var(--bg-primary); padding: 24px; border-radius: var(--radius); border: 1px solid var(--border-color); box-shadow: var(--shadow-light); margin-bottom: 24px; color: var(--text-primary); display: block;">
                        <p style="font-size: 14px; color: var(--text-secondary); margin: 0;">Registra tus ingresos y gastos para mantener un control detallado de tus finanzas. Puedes asociar transacciones a cuentas bancarias, propiedades, pr√©stamos o inversiones.</p>
                    </div>
                    <form id="transactionForm" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="transactionType" data-translate="transactions.type">Tipo</label>
                                <select id="transactionType" required>
                                    <option value="income" data-translate="transactions.income">Ingreso</option>
                                    <option value="expense" data-translate="transactions.expense">Gasto</option>
                                    <option value="transfer">Transferencia</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="transactionDate" data-translate="transactions.date">Fecha</label>
                                <input type="date" id="transactionDate" required>
                            </div>
                            <div class="form-group">
                                <label for="transactionAmount" data-translate="transactions.amount">Monto</label>
                                <input type="number" id="transactionAmount" step="0.01" min="0" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="categoryGeneral" data-translate="transactions.categoryGeneral">Categor√≠a General</label>
                                <select id="categoryGeneral" required>
                                    <option value="" data-translate="common.select">Seleccionar...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="categorySpecific" data-translate="transactions.categorySpecific">Categor√≠a Espec√≠fica</label>
                                <select id="categorySpecific" required>
                                    <option value="" data-translate="common.select">Seleccionar...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="envelope" data-translate="transactions.envelope">Sobre (Opcional)</label>
                                <select id="envelope">
                                    <option value="" data-translate="common.none">Ninguno</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="transactionBudget">Presupuesto (Opcional)</label>
                                <select id="transactionBudget">
                                    <option value="" data-translate="common.none">Ninguno</option>
                                </select>
                                <small>Asigna esta transacci√≥n a un presupuesto espec√≠fico</small>
                            </div>
                        </div>
                        <div class="form-row" id="transferAccountsRow" style="display: none;">
                            <div class="form-group">
                                <label for="transactionFromAccount">Cuenta Origen</label>
                                <select id="transactionFromAccount">
                                    <option value="" data-translate="common.select">Seleccionar...</option>
                                </select>
                                <small>Cuenta desde la que se transfiere el dinero</small>
                            </div>
                            <div class="form-group">
                                <label for="transactionToAccount">Cuenta Destino</label>
                                <select id="transactionToAccount">
                                    <option value="" data-translate="common.select">Seleccionar...</option>
                                </select>
                                <small>Cuenta hacia la que se transfiere el dinero</small>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="transactionAccount" data-translate="transactions.account">Cuenta Bancaria (Opcional)</label>
                                <select id="transactionAccount">
                                    <option value="" data-translate="common.none">Ninguna</option>
                                </select>
                                <small>Selecciona la cuenta desde/hacia la que se realiza la transacci√≥n</small>
                            </div>
                            <div class="form-group">
                                <label for="transactionInvestment">Inversi√≥n (Opcional)</label>
                                <select id="transactionInvestment">
                                    <option value="">Ninguna</option>
                                </select>
                                <small>Si este gasto/ingreso es para una inversi√≥n, selecci√≥nala</small>
                            </div>
                            <div class="form-group">
                                <label for="transactionLoan">Pr√©stamo (Opcional)</label>
                                <select id="transactionLoan">
                                    <option value="">Ninguno</option>
                                </select>
                                <small>Asocia este gasto a un pr√©stamo espec√≠fico</small>
                            </div>
                            <div class="form-group">
                                <label for="transactionProperty">Propiedad/Piso (Opcional)</label>
                                <select id="transactionProperty">
                                    <option value="">Ninguna</option>
                                </select>
                                <small>Asocia este gasto a una propiedad espec√≠fica</small>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group" style="flex: 1;">
                                <label for="transactionDescription">Descripci√≥n</label>
                                <input type="text" id="transactionDescription" placeholder="Ej: Compra en supermercado">
                            </div>
                        </div>
                        <button type="submit" class="btn-primary" id="transactionSubmitBtn">Agregar Transacci√≥n</button>
                        <button type="button" class="btn-secondary" id="transactionCancelBtn" onclick="resetTransactionForm()" style="display: none; margin-left: 8px;">Cancelar</button>
                    </form>
                </div>

                <div class="table-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 12px;">
                        <h2 data-translate="transactions.history" style="margin: 0;">Historial de Transacciones</h2>
                        <button type="button" id="toggleFiltersBtn" class="btn-secondary" style="display: none; padding: 10px 16px; border: 1.5px solid var(--border-color); border-radius: var(--radius); background: var(--bg-primary); color: var(--text-primary); cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s; align-items: center; gap: 8px;" onclick="toggleTransactionFilters()">
                            <span id="toggleFiltersText">Mostrar Filtros</span>
                            <svg id="toggleFiltersIcon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="transition: transform 0.3s ease;">
                                <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                            </div>
                    <div class="table-controls" id="transactionFilters" style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 12px; align-items: end; padding: 20px; background: var(--bg-secondary, var(--gray-50)); border-radius: var(--radius-md); border: 1px solid var(--border-color); margin-bottom: 20px;">
                        <div style="display: flex; flex-direction: column; gap: 6px;">
                            <label style="font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px;">Buscar</label>
                            <input type="text" id="searchInput" placeholder="Buscar transacciones..." style="padding: 12px 16px; border: 1.5px solid var(--border-color); border-radius: var(--radius); font-size: 14px; background: var(--bg-primary); color: var(--text-primary); transition: all 0.2s; width: 100%;">
                            </div>
                        <div style="display: flex; flex-direction: column; gap: 6px;">
                            <label style="font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px;">Categor√≠a</label>
                            <select id="filterCategory" style="padding: 12px 16px; border: 1.5px solid var(--border-color); border-radius: var(--radius); font-size: 14px; background: var(--bg-primary); color: var(--text-primary); cursor: pointer; transition: all 0.2s; width: 100%;">
                                <option value="">Todas las categor√≠as</option>
                            </select>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 6px;">
                            <label style="font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px;">Mes</label>
                            <select id="filterMonth" style="padding: 12px 16px; border: 1.5px solid var(--border-color); border-radius: var(--radius); font-size: 14px; background: var(--bg-primary); color: var(--text-primary); cursor: pointer; transition: all 0.2s; width: 100%;">
                                <option value="">Todos los meses</option>
                            </select>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 6px;">
                            <label style="font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px;">Desde</label>
                            <input type="date" id="filterStartDate" style="padding: 12px 16px; border: 1.5px solid var(--border-color); border-radius: var(--radius); font-size: 14px; background: var(--bg-primary); color: var(--text-primary); cursor: pointer; transition: all 0.2s; width: 100%;">
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 6px;">
                            <label style="font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px;">Hasta</label>
                            <input type="date" id="filterEndDate" style="padding: 12px 16px; border: 1.5px solid var(--border-color); border-radius: var(--radius); font-size: 14px; background: var(--bg-primary); color: var(--text-primary); cursor: pointer; transition: all 0.2s; width: 100%;">
                        </div>
                    </div>
                    <div class="table-container" id="transactionsTableContainer" style="max-height: 600px; overflow-y: auto;">
                        <table id="transactionsTable">
                            <thead>
                                <tr>
                                    <th class="sortable" data-sort="date" data-translate="transactions.date" style="cursor: pointer; user-select: none;">
                                        Fecha <span class="sort-indicator"></span>
                                    </th>
                                    <th class="sortable" data-sort="type" data-translate="transactions.type" style="cursor: pointer; user-select: none;">
                                        Tipo <span class="sort-indicator"></span>
                                    </th>
                                    <th class="sortable" data-sort="category" data-translate="transactions.category" style="cursor: pointer; user-select: none;">
                                        <span class="category-label-full">Categor√≠a</span><span class="category-label-short" style="display: none;">Cat.</span> <span class="sort-indicator"></span>
                                    </th>
                                    <th class="sortable" data-sort="description" data-translate="transactions.description" style="cursor: pointer; user-select: none;">
                                        Descripci√≥n <span class="sort-indicator"></span>
                                    </th>
                                    <th class="sortable" data-sort="account" data-translate="transactions.account" style="cursor: pointer; user-select: none;">
                                        Cuenta <span class="sort-indicator"></span>
                                    </th>
                                    <th class="sortable" data-sort="property" data-translate="transactions.property" style="cursor: pointer; user-select: none;">
                                        Propiedad <span class="sort-indicator"></span>
                                    </th>
                                    <th class="sortable" data-sort="envelope" data-translate="transactions.envelope" style="cursor: pointer; user-select: none;">
                                        Sobre <span class="sort-indicator"></span>
                                    </th>
                                    <th class="sortable" data-sort="amount" data-translate="transactions.amount" style="cursor: pointer; user-select: none;">
                                        Monto <span class="sort-indicator"></span>
                                    </th>
                                    <th data-translate="transactions.actions">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="transactionsBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Tab: Propiedades/Pisos -->
            <div class="tab-content" id="properties-tab">
                <div class="form-section">
                    <div style="display: flex; justify-content: flex-end; align-items: center; margin-bottom: 20px;">
                        <button type="button" class="btn-primary" id="togglePropertyFormBtn" onclick="toggleForm('propertyForm', 'togglePropertyFormBtn')" style="display: flex; align-items: center; gap: 8px;">
                            <span id="propertyFormText">Nueva Propiedad</span>
                        </button>
                    </div>
                    <div style="background: var(--bg-primary); padding: 24px; border-radius: var(--radius); border: 1px solid var(--border-color); box-shadow: var(--shadow-light); margin-bottom: 24px; color: var(--text-primary);">
                        <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 20px;">Registra tus propiedades o pisos para asociar gastos espec√≠ficos a cada una (agua, luz, comunidad, etc.).</p>
                    </div>
                    <form id="propertyForm" style="display: none; background: var(--bg-primary); padding: 24px; border-radius: var(--radius); border: 1px solid var(--border-color); box-shadow: var(--shadow-light); color: var(--text-primary);">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="propertyName">Nombre de la Propiedad</label>
                                <input type="text" id="propertyName" placeholder="Ej: Piso Calle Mayor 5" required>
                            </div>
                            <div class="form-group">
                                <label for="propertyType">Tipo</label>
                                <select id="propertyType" required>
                                    <option value="apartment">Piso/Apartamento</option>
                                    <option value="house">Casa</option>
                                    <option value="office">Oficina</option>
                                    <option value="commercial">Local Comercial</option>
                                    <option value="other">Otro</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group" style="flex: 2;">
                                <label for="propertyAddress">Direcci√≥n (Opcional)</label>
                                <input type="text" id="propertyAddress" placeholder="Ej: Calle Mayor 5, 3¬∫B, Madrid">
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="propertyDescription">Descripci√≥n (Opcional)</label>
                                <input type="text" id="propertyDescription" placeholder="Ej: Piso principal, alquiler">
                            </div>
                        </div>
                        <button type="submit" class="btn-primary">Agregar Propiedad</button>
                    </form>
                </div>

                <div class="table-section" style="margin-top: 32px;">
                    <h2>Mis Propiedades</h2>
                    <div id="propertiesGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                    </div>
                </div>
            </div>

            <!-- Tab: Cuentas Bancarias -->
            <div class="tab-content" id="accounts-tab">
                <div class="form-section">
                    <div style="display: flex; justify-content: flex-end; align-items: center; margin-bottom: 20px;">
                        <button type="button" class="btn-primary" id="toggleAccountFormBtn" onclick="toggleForm('accountForm', 'toggleAccountFormBtn')" style="display: flex; align-items: center; gap: 8px;">
                            <span id="accountFormText">Nueva Cuenta</span>
                        </button>
                    </div>
                    <div style="background: var(--bg-primary); padding: 24px; border-radius: var(--radius); border: 1px solid var(--border-color); box-shadow: var(--shadow-light); margin-bottom: 24px; color: var(--text-primary);">
                        <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 20px;">Registra tus cuentas bancarias para hacer seguimiento de tus saldos en diferentes entidades y tipos de cuenta.</p>
                    </div>
                    <form id="accountForm" style="display: none; background: var(--bg-primary); padding: 24px; border-radius: var(--radius); border: 1px solid var(--border-color); box-shadow: var(--shadow-light); color: var(--text-primary);">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="accountName">Nombre de la Cuenta</label>
                                <input type="text" id="accountName" placeholder="Ej: Cuenta N√≥mina BBVA" required>
                            </div>
                            <div class="form-group">
                                <label for="accountType">Tipo de Cuenta</label>
                                <select id="accountType" required>
                                    <option value="checking">Cuenta Corriente</option>
                                    <option value="savings">Cuenta de Ahorros</option>
                                    <option value="credit">Tarjeta de Cr√©dito</option>
                                    <option value="investment">Cuenta de Inversi√≥n</option>
                                    <option value="other">Otra</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="accountBank">Banco (Opcional)</label>
                                <input type="text" id="accountBank" placeholder="Ej: BBVA, Santander, etc.">
                            </div>
                            <div class="form-group">
                                <label for="accountNumber">N√∫mero de Cuenta (Opcional)</label>
                                <input type="text" id="accountNumber" placeholder="√öltimos 4 d√≠gitos o referencia">
                            </div>
                            <div class="form-group">
                                <label for="accountBalance">Saldo Actual (‚Ç¨)</label>
                                <input type="number" id="accountBalance" step="0.01" required placeholder="0.00">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="accountDescription">Descripci√≥n (Opcional)</label>
                                <input type="text" id="accountDescription" placeholder="Ej: Cuenta principal para gastos diarios">
                            </div>
                        </div>
                        <button type="submit" class="btn-primary">Agregar Cuenta</button>
                    </form>
                </div>
                <div class="accounts-grid" id="accountsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; margin-top: 30px;">
                </div>
            </div>

            <!-- Tab: Presupuestos -->
            <div class="tab-content" id="envelopes-tab">
                <div class="form-section">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 32px; margin-bottom: 24px;" class="budgets-form-grid">
                        <div style="background: transparent; padding: 24px; border-radius: var(--radius); border: 1px solid var(--border-color); box-shadow: var(--shadow-light); overflow: visible; word-wrap: break-word; overflow-wrap: break-word; box-sizing: border-box; color: var(--text-primary);">
                            <div style="display: flex; justify-content: flex-end; align-items: center; margin-bottom: 20px;">
                                <button type="button" class="btn-primary" id="toggleBudgetFormBtn" onclick="toggleForm('budgetForm', 'toggleBudgetFormBtn')" style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; font-size: 14px;">
                                    <span id="budgetFormText">Nuevo Presupuesto</span>
                                </button>
                            </div>
                            <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 20px; word-wrap: break-word; overflow-wrap: break-word;">Establece un presupuesto para una categor√≠a de ingreso o gasto. Puedes elegir entre presupuesto semanal, mensual o anual.</p>
                            <form id="budgetForm" style="display: none;">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="budgetType">Tipo de Presupuesto</label>
                                        <select id="budgetType" required>
                                            <option value="expense">Gasto</option>
                                            <option value="income">Ingreso</option>
                                        </select>
                                        <small>Elige si es un presupuesto de ingreso o gasto</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="budgetTargetType">Asignar a</label>
                                        <select id="budgetTargetType" required onchange="toggleBudgetTarget()">
                                            <option value="category">Categor√≠a</option>
                                            <option value="property">Propiedad</option>
                                            <option value="patrimonio">Patrimonio</option>
                                        </select>
                                        <small>Elige si asignar a categor√≠a, propiedad espec√≠fica o patrimonio</small>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group" id="budgetCategoryGroup">
                                        <label for="budgetCategoryGeneral">Categor√≠a General</label>
                                        <select id="budgetCategoryGeneral" required>
                                            <option value="">Seleccionar categor√≠a...</option>
                                        </select>
                                        <small>Elige la categor√≠a general que quieres presupuestar</small>
                                    </div>
                                    <div class="form-group" id="budgetCategorySpecificGroup">
                                        <label for="budgetCategorySpecific">Categor√≠a Espec√≠fica</label>
                                        <select id="budgetCategorySpecific" required>
                                            <option value="">Seleccionar subcategor√≠a...</option>
                                        </select>
                                        <small>Elige la subcategor√≠a espec√≠fica</small>
                                    </div>
                                    <div class="form-group" id="budgetPropertyGroup" style="display: none;">
                                        <label for="budgetProperty">Propiedad</label>
                                        <select id="budgetProperty">
                                            <option value="">Seleccionar propiedad...</option>
                                        </select>
                                        <small>Elige la propiedad espec√≠fica (piso alquilado, casa, etc.)</small>
                                    </div>
                                    <div class="form-group" id="budgetPatrimonioGroup" style="display: none;">
                                        <label for="budgetPatrimonio">Patrimonio</label>
                                        <select id="budgetPatrimonio">
                                            <option value="">Seleccionar patrimonio...</option>
                                        </select>
                                        <small>Elige el patrimonio (propiedad, coche, etc.)</small>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="budgetPeriodType">Tipo de Per√≠odo</label>
                                        <select id="budgetPeriodType" required>
                                            <option value="weekly">Semanal</option>
                                            <option value="monthly" selected>Mensual</option>
                                            <option value="yearly">Anual</option>
                                        </select>
                                        <small>Frecuencia del presupuesto</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="budgetPeriodValue" id="budgetPeriodValueLabel">Mes de Inicio</label>
                                        <input type="month" id="budgetPeriodValue" required>
                                        <small id="budgetPeriodValueHelp">Mes desde el que comienza el presupuesto</small>
                                    </div>
                                    <div class="form-group" id="budgetDurationGroup">
                                        <label for="budgetDuration" id="budgetDurationLabel">Duraci√≥n</label>
                                        <select id="budgetDuration">
                                            <option value="1">1 mes</option>
                                            <option value="3">3 meses</option>
                                            <option value="6">6 meses</option>
                                            <option value="12">12 meses (1 a√±o)</option>
                                            <option value="24">24 meses (2 a√±os)</option>
                                            <option value="0">Indefinido (hasta cancelar)</option>
                                        </select>
                                        <small id="budgetDurationHelp">Por cu√°ntos meses aplicar este presupuesto</small>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="budgetAmount" id="budgetAmountLabel">Presupuesto Mensual (‚Ç¨)</label>
                                        <input type="number" id="budgetAmount" step="0.01" min="0" required placeholder="0.00">
                                        <small id="budgetAmountHelp">L√≠mite m√°ximo de gasto para esta categor√≠a</small>
                                    </div>
                                </div>
                                <button type="submit" class="btn-primary" style="width: 100%; margin-top: 8px;">Establecer Presupuesto</button>
                            </form>
                        </div>
                        <div style="background: transparent; padding: 24px; border-radius: var(--radius); border: 1px solid var(--border-color); box-shadow: var(--shadow-light); color: var(--text-primary);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <h3 style="font-size: 18px; font-weight: 700; margin: 0; color: var(--text-primary);">Sobre (Presupuesto Flexible)</h3>
                                </div>
                                <button type="button" class="btn-primary" id="toggleEnvelopeFormBtn" onclick="toggleForm('envelopeForm', 'toggleEnvelopeFormBtn')" style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; font-size: 14px;">
                                    <span id="envelopeFormText">Nuevo Sobre</span>
                                </button>
                            </div>
                            <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 20px;">Crea un sobre para ahorrar para un objetivo espec√≠fico. Puedes asignar transacciones a sobres.</p>
                    <form id="envelopeForm" style="display: none;">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="envelopeName">Nombre del Sobre</label>
                                        <input type="text" id="envelopeName" placeholder="Ej: Vacaciones, Emergencias, Regalos..." required>
                                        <small>Un nombre descriptivo para tu objetivo</small>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="envelopeCategoryGeneral">Categor√≠a General</label>
                                        <select id="envelopeCategoryGeneral" required>
                                            <option value="">Seleccionar categor√≠a...</option>
                                        </select>
                                        <small>Elige la categor√≠a general del sobre</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="envelopeCategorySpecific">Categor√≠a Espec√≠fica</label>
                                        <select id="envelopeCategorySpecific" required>
                                            <option value="">Seleccionar subcategor√≠a...</option>
                                        </select>
                                        <small>Elige la subcategor√≠a espec√≠fica</small>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="envelopeBudget">Presupuesto Mensual (‚Ç¨)</label>
                                        <input type="number" id="envelopeBudget" step="0.01" min="0" required placeholder="0.00">
                                        <small>Cu√°nto planeas ahorrar cada mes en este sobre</small>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 8px; margin-top: 8px;">
                                    <button type="submit" class="btn-primary" id="envelopeSubmitBtn" style="flex: 1;">Agregar Sobre</button>
                                    <button type="button" class="btn-secondary" id="envelopeCancelBtn" onclick="resetEnvelopeForm()" style="display: none;">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 32px;">
                    <h2 style="font-size: 20px; font-weight: 700; margin-bottom: 20px; color: var(--text-primary);">Presupuestos del Mes</h2>
                    <div id="budgetsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; margin-bottom: 32px;">
                    </div>
                    <h2 style="font-size: 20px; font-weight: 700; margin-bottom: 20px; color: var(--text-primary);">Sobres</h2>
                    <div class="envelopes-grid" id="envelopesGrid">
                    </div>
                </div>
            </div>

            <!-- Tab: Pr√©stamos -->
            <div class="tab-content" id="loans-tab">
                <div class="form-section">
                    <div style="display: flex; justify-content: flex-end; align-items: center; margin-bottom: 20px;">
                        <button type="button" class="btn-primary" id="toggleLoanFormBtn" onclick="toggleForm('loanForm', 'toggleLoanFormBtn')" style="display: flex; align-items: center; gap: 8px;">
                            <span id="loanFormText">Nuevo Pr√©stamo</span>
                        </button>
                    </div>
                    
                    <!-- Modal para tabla de amortizaci√≥n -->
                    <div id="amortizationModal" class="modal" style="display: none;">
                        <div class="modal-content" style="max-width: 90%; width: 1000px; max-height: 90vh; padding: 0; overflow: hidden; display: flex; flex-direction: column;">
                            <div class="rainbow-bg" style="padding: 28px 32px; position: sticky; top: 0; z-index: 10; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <h2 id="amortizationModalTitle" style="margin: 0; font-size: 26px; font-weight: 700; letter-spacing: -0.5px;">Tabla de Amortizaci√≥n</h2>
                                    <button onclick="closeAmortizationModal()" class="modal-close-btn" style="background: rgba(0,0,0,0.1); border: 1px solid rgba(0,0,0,0.2); padding: 8px 12px; border-radius: 50%; transition: all 0.2s; cursor: pointer; font-size: 18px; font-weight: 300;" onmouseover="this.style.background='rgba(0,0,0,0.2)'" onmouseout="this.style.background='rgba(0,0,0,0.1)'">√ó</button>
                                </div>
                            </div>
                            <div id="amortizationModalContent" style="padding: 32px; max-height: calc(90vh - 100px); overflow-y: auto; flex: 1;">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Modal para amortizaci√≥n anticipada -->
                    <div id="earlyPaymentModal" class="modal" style="display: none;">
                        <div class="modal-content" style="max-width: 600px; max-height: 90vh; padding: 0; overflow: hidden; display: flex; flex-direction: column;">
                            <div class="rainbow-bg" style="padding: 28px 32px; position: sticky; top: 0; z-index: 10; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <h2 style="margin: 0; font-size: 26px; font-weight: 700; letter-spacing: -0.5px;">Amortizaci√≥n Anticipada</h2>
                                    <button onclick="closeEarlyPaymentModal()" class="modal-close-btn" style="background: rgba(0,0,0,0.1); border: 1px solid rgba(0,0,0,0.2); padding: 8px 12px; border-radius: 50%; transition: all 0.2s; cursor: pointer; font-size: 18px; font-weight: 300;" onmouseover="this.style.background='rgba(0,0,0,0.2)'" onmouseout="this.style.background='rgba(0,0,0,0.1)'">√ó</button>
                                </div>
                            </div>
                            <div style="padding: 32px; max-height: calc(90vh - 100px); overflow-y: auto; flex: 1;">
                                <div id="earlyPaymentLoanInfo" style="margin-bottom: 24px; padding: 20px; background: var(--gray-50); border-radius: 12px; border-left: 4px solid var(--primary);">
                                </div>
                                <form id="earlyPaymentForm" style="display: flex; flex-direction: column; gap: 20px;">
                                    <div class="form-group">
                                        <label for="earlyPaymentAmount">Monto a Amortizar (‚Ç¨)</label>
                                        <input type="number" id="earlyPaymentAmount" step="0.01" min="0.01" required placeholder="0.00" style="width: 100%; padding: 14px 18px; border: 1.5px solid var(--border-color); border-radius: 10px; font-size: 15px;">
                                        <small style="color: var(--gray-500); margin-top: 6px; display: block;">Ingresa el monto que deseas amortizar anticipadamente</small>
                                    </div>
                                    <div id="earlyPaymentCommissionInfo" style="padding: 16px; background: #FEF3C7; border-radius: 12px; border-left: 4px solid var(--warning); display: none;">
                                        <strong style="color: var(--text-primary);">Comisi√≥n:</strong> <span id="earlyPaymentCommissionAmount" style="color: var(--text-secondary);">0,00 ‚Ç¨</span>
                                    </div>
                                    <div id="earlyPaymentEffect" style="display: none; margin-top: 16px; padding: 20px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.15) 100%); border-radius: 12px; border-left: 4px solid var(--success);">
                                        <h4 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 700; color: var(--text-primary);">Efecto de la Amortizaci√≥n</h4>
                                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px;">
                                            <div>
                                                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">Nuevo Capital Pendiente</div>
                                                <div id="newRemainingCapital" style="font-size: 18px; font-weight: 700; color: var(--success);">-</div>
                                            </div>
                                            <div>
                                                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">Ahorro en Intereses</div>
                                                <div id="interestSavings" style="font-size: 18px; font-weight: 700; color: var(--success);">-</div>
                                            </div>
                                            <div>
                                                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">Cuotas Reducidas</div>
                                                <div id="reducedPayments" style="font-size: 18px; font-weight: 700; color: var(--text-primary);">-</div>
                                            </div>
                                            <div>
                                                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">Nueva Cuota Mensual</div>
                                                <div id="newMonthlyPayment" style="font-size: 18px; font-weight: 700; color: var(--text-primary);">-</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 12px; justify-content: center; align-items: center; padding-top: 20px; border-top: 1px solid var(--border-color);">
                                        <button type="button" class="btn-secondary" onclick="closeEarlyPaymentModal()" style="flex: 1; min-width: 120px; padding: 12px 24px; font-size: 15px; font-weight: 600;">Cancelar</button>
                                        <button type="submit" class="btn-primary" style="flex: 1; min-width: 120px; padding: 12px 24px; font-size: 15px; font-weight: 600;">Confirmar Amortizaci√≥n</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div style="background: var(--bg-primary); padding: 24px; border-radius: var(--radius); border: 1px solid var(--border-color); box-shadow: var(--shadow-light); margin-bottom: 24px; color: var(--text-primary);">
                        <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 20px;">Registra tus pr√©stamos e hipotecas para hacer un seguimiento del capital restante, intereses y realizar simulaciones de amortizaci√≥n anticipada.</p>
                    </div>
                    <form id="loanForm" style="display: none; background: var(--bg-primary); padding: 24px; border-radius: var(--radius); border: 1px solid var(--border-color); box-shadow: var(--shadow-light); color: var(--text-primary);">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="loanName">Nombre del Pr√©stamo</label>
                                <input type="text" id="loanName" placeholder="Ej: Hipoteca vivienda" required>
                            </div>
                            <div class="form-group">
                                <label for="loanType">Tipo</label>
                                <select id="loanType" required>
                                    <option value="debt">Deuda (Debo)</option>
                                    <option value="credit">Cr√©dito (Me deben)</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="loanPrincipal">Monto Principal (‚Ç¨)</label>
                                <input type="number" id="loanPrincipal" step="0.01" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="loanInterestRate">TIN - Tipo de Inter√©s Nominal (%)</label>
                                <input type="number" id="loanInterestRate" step="0.01" min="0" max="100" required>
                                <small style="color: var(--text-tertiary);">Inter√©s puro sin comisiones</small>
                            </div>
                            <div class="form-group">
                                <label for="loanTAE">TAE - Tasa Anual Equivalente (%)</label>
                                <input type="number" id="loanTAE" step="0.01" min="0" max="100" placeholder="Opcional">
                                <small style="color: var(--text-tertiary); font-weight: 600;">IMPORTANTE: Incluye comisiones y gastos. Es el costo REAL del pr√©stamo.</small>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="loanStartDate">Fecha de Inicio</label>
                                <input type="date" id="loanStartDate" required>
                            </div>
                            <div class="form-group">
                                <label for="loanEndDate">Fecha de Fin</label>
                                <input type="date" id="loanEndDate" required>
                            </div>
                            <div class="form-group">
                                <label for="loanMonthlyPayment">Pago Mensual (‚Ç¨)</label>
                                <input type="number" id="loanMonthlyPayment" step="0.01" min="0" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="loanOpeningCommission">Comisi√≥n de Apertura (‚Ç¨)</label>
                                <input type="number" id="loanOpeningCommission" step="0.01" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label for="loanEarlyPaymentCommission">Comisi√≥n Amortizaci√≥n Anticipada (%)</label>
                                <input type="number" id="loanEarlyPaymentCommission" step="0.01" min="0" max="100" value="0">
                            </div>
                            <div class="form-group">
                                <label for="loanPaymentDay">D√≠a de Pago del Mes</label>
                                <input type="number" id="loanPaymentDay" min="1" max="31" value="1" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="loanAccount">Cuenta para Pagos (Opcional)</label>
                                <select id="loanAccount">
                                    <option value="">Ninguna</option>
                                </select>
                                <small style="color: var(--text-tertiary);">Cuenta desde la que se realizar√°n los pagos del pr√©stamo</small>
                            </div>
                            <div class="form-group">
                                <label for="loanProperty">Propiedad Asociada (Opcional)</label>
                                <select id="loanProperty">
                                    <option value="">Ninguna</option>
                                </select>
                                <small style="color: var(--text-tertiary);">Propiedad inmobiliaria relacionada (ej: hipoteca de vivienda)</small>
                            </div>
                            <div class="form-group">
                                <label for="loanPatrimonio">Patrimonio Asociado (Opcional)</label>
                                <select id="loanPatrimonio">
                                    <option value="">Ninguno</option>
                                </select>
                                <small style="color: var(--text-tertiary);">Patrimonio relacionado (ej: pr√©stamo de veh√≠culo)</small>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group" style="flex: 2;">
                                <label for="loanDescription">Descripci√≥n (Opcional)</label>
                                <input type="text" id="loanDescription" placeholder="Ej: Hipoteca banco XYZ, cuenta 1234">
                            </div>
                        </div>
                        <button type="submit" class="btn-primary">Agregar Pr√©stamo</button>
                    </form>
                </div>
                <div class="loans-grid" id="loansGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; margin-top: 30px;">
                </div>
            </div>

            <!-- Tab: Gastos Recurrentes -->
            <div class="tab-content" id="recurring-expenses-tab">
                <div class="form-section">
                    <div style="display: flex; justify-content: flex-end; align-items: center; margin-bottom: 20px;">
                        <button type="button" class="btn-primary" id="toggleRecurringExpenseFormBtn" onclick="toggleForm('recurringExpenseForm', 'toggleRecurringExpenseFormBtn')" style="display: flex; align-items: center; gap: 8px;">
                            <span id="recurringExpenseFormText">Nuevo Gasto Recurrente</span>
                        </button>
                    </div>
                    
                    <form id="recurringExpenseForm" style="display: none; background: var(--bg-primary); padding: 24px; border-radius: var(--radius); border: 1px solid var(--border-color); box-shadow: var(--shadow-light); color: var(--text-primary);">
                        <div class="form-row">
                            <div class="form-group" style="flex: 2;">
                                <label for="recurringExpenseName">Nombre del Gasto</label>
                                <input type="text" id="recurringExpenseName" placeholder="Ej: Alquiler piso principal" required>
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="recurringExpenseAmount">Monto</label>
                                <input type="number" id="recurringExpenseAmount" step="0.01" min="0" placeholder="0.00" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="recurringExpenseCategoryGeneral">Categor√≠a General</label>
                                <select id="recurringExpenseCategoryGeneral" required>
                                    <option value="">Seleccionar categor√≠a...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="recurringExpenseCategorySpecific">Categor√≠a Espec√≠fica</label>
                                <select id="recurringExpenseCategorySpecific" required>
                                    <option value="">Seleccionar subcategor√≠a...</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="recurringExpenseFrequency">Frecuencia</label>
                                <select id="recurringExpenseFrequency" required>
                                    <option value="monthly">Mensual</option>
                                    <option value="weekly">Semanal</option>
                                    <option value="yearly">Anual</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="recurringExpensePaymentDay">D√≠a de Pago</label>
                                <input type="number" id="recurringExpensePaymentDay" min="1" max="31" value="1" required>
                                <small>D√≠a del mes en que se realiza el pago</small>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="recurringExpenseStartDate">Fecha de Inicio</label>
                                <input type="date" id="recurringExpenseStartDate" required>
                            </div>
                            <div class="form-group">
                                <label for="recurringExpenseEndDate">Fecha de Fin (Opcional)</label>
                                <input type="date" id="recurringExpenseEndDate">
                                <small>Dejar vac√≠o para gasto indefinido</small>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="recurringExpenseGroup">Grupo de Gastos (Opcional)</label>
                                <input type="text" id="recurringExpenseGroup" placeholder="Ej: Piso alquilado donde vivo">
                                <small>Agrupa gastos relacionados (alquiler, facturas, reparaciones, etc.)</small>
                            </div>
                            <div class="form-group">
                                <label for="recurringExpenseProperty">Propiedad Asociada (Opcional)</label>
                                <select id="recurringExpenseProperty">
                                    <option value="">Ninguna</option>
                                </select>
                                <small>Propiedad registrada en el sistema</small>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="recurringExpenseAccount">Cuenta (Opcional)</label>
                                <select id="recurringExpenseAccount">
                                    <option value="">Ninguna</option>
                                </select>
                                <small>Cuenta desde la que se realiza el pago</small>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group" style="flex: 2;">
                                <label for="recurringExpenseDescription">Descripci√≥n (Opcional)</label>
                                <input type="text" id="recurringExpenseDescription" placeholder="Ej: Alquiler mensual del piso">
                            </div>
                        </div>
                        <button type="submit" class="btn-primary">Agregar Gasto Recurrente</button>
                    </form>
                </div>
                <div class="recurring-expenses-grid" id="recurringExpensesGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; margin-top: 30px;">
                </div>
            </div>

            <!-- Tab: Inversiones -->
            <div class="tab-content" id="investments-tab">
                <div class="form-section">
                    <div style="display: flex; justify-content: flex-end; align-items: center; margin-bottom: 20px;">
                        <button type="button" class="btn-primary" id="toggleInvestmentFormBtn" onclick="toggleForm('investmentForm', 'toggleInvestmentFormBtn')" style="display: flex; align-items: center; gap: 8px;">
                            <span id="investmentFormText">Nueva Inversi√≥n</span>
                        </button>
                    </div>
                    <div style="background: var(--bg-primary); padding: 24px; border-radius: var(--radius); border: 1px solid var(--border-color); box-shadow: var(--shadow-light); margin-bottom: 24px; color: var(--text-primary);">
                        <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 20px;">Registra tus inversiones para hacer seguimiento de su rendimiento, ganancias/p√©rdidas y rentabilidad total.</p>
                    </div>
                    <form id="investmentForm" style="display: none; background: var(--bg-primary); padding: 24px; border-radius: var(--radius); border: 1px solid var(--border-color); box-shadow: var(--shadow-light); color: var(--text-primary);">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="investmentName">Nombre de la Inversi√≥n</label>
                                <input type="text" id="investmentName" placeholder="Ej: Acciones Apple, Plan de Pensiones" required>
                            </div>
                            <div class="form-group">
                                <label for="investmentType">Tipo</label>
                                <select id="investmentType" required>
                                    <option value="stocks">Acciones</option>
                                    <option value="bonds">Bonos</option>
                                    <option value="crypto">Criptomonedas</option>
                                    <option value="funds">Fondos</option>
                                    <option value="real_estate">Inmuebles</option>
                                    <option value="other">Otros</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="investmentCurrentValue">Valor Actual (‚Ç¨)</label>
                                <input type="number" id="investmentCurrentValue" step="0.01" min="0" required>
                                <small>Valor actual de tu inversi√≥n</small>
                            </div>
                            <div class="form-group full-width">
                                <label for="investmentDescription">Descripci√≥n (Opcional)</label>
                                <input type="text" id="investmentDescription" placeholder="Ej: Inversi√≥n a largo plazo">
                            </div>
                        </div>
                        <div style="background: var(--gray-50); padding: 16px; border-radius: var(--radius); margin: 16px 0; border-left: 3px solid var(--primary);">
                            <p style="font-size: 13px; color: var(--text-secondary); margin: 0;">
                                <strong>Funciona como una hucha:</strong> Una vez creada, podr√°s ir a√±adiendo dinero progresivamente. La rentabilidad se calcular√° autom√°ticamente en base al total invertido vs el valor actual.
                            </p>
                        </div>
                        <div class="form-row" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                            <div class="form-group full-width">
                                <label style="font-weight: 600; margin-bottom: 12px; display: block; word-wrap: break-word; overflow-wrap: break-word;">Aportes Peri√≥dicos (Opcional)</label>
                                <div class="periodic-contribution-checkbox-container" style="display: flex; gap: 12px; align-items: flex-start; margin-bottom: 12px; word-wrap: break-word; overflow-wrap: break-word; width: 100%; box-sizing: border-box;">
                                    <input type="checkbox" id="enablePeriodicContribution" class="periodic-contribution-checkbox" style="width: auto; flex-shrink: 0; margin-top: 2px;">
                                    <label for="enablePeriodicContribution" class="periodic-contribution-checkbox-label" style="margin: 0; font-weight: normal; word-wrap: break-word; overflow-wrap: break-word; flex: 1; min-width: 0; cursor: pointer;">Activar aportes peri√≥dicos</label>
                                </div>
                            </div>
                        </div>
                        <div id="periodicContributionFields" style="display: none;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="contributionFrequency">Frecuencia</label>
                                    <select id="contributionFrequency">
                                        <option value="weekly">Semanal</option>
                                        <option value="monthly" selected>Mensual</option>
                                        <option value="yearly">Anual</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="contributionAmount">Monto del Aporte (‚Ç¨)</label>
                                    <input type="number" id="contributionAmount" step="0.01" min="0" placeholder="0.00">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="contributionStartDate">Fecha de Inicio</label>
                                    <input type="date" id="contributionStartDate">
                                </div>
                                <div class="form-group">
                                    <label for="contributionEndDate">Fecha de Fin (Opcional)</label>
                                    <input type="date" id="contributionEndDate">
                                    <small>Dejar vac√≠o para aportes indefinidos</small>
                                </div>
                                <div class="form-group">
                                    <label for="contributionAccount">Cuenta para Aportes (Opcional)</label>
                                    <select id="contributionAccount">
                                        <option value="">Ninguna</option>
                                    </select>
                                    <small style="color: var(--text-tertiary);">Cuenta desde la que se realizar√°n los aportes</small>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn-primary">Agregar Inversi√≥n</button>
                    </form>
                </div>
                <div class="investments-grid" id="investmentsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 16px; margin-top: 24px;">
                </div>
            </div>

            <!-- Tab: Patrimonio -->
            <div class="tab-content" id="assets-tab">
                <div class="form-section">
                    <div style="display: flex; justify-content: flex-end; align-items: center; margin-bottom: 20px;">
                        <button type="button" class="btn-primary" id="togglePatrimonioFormBtn" onclick="toggleForm('patrimonioForm', 'togglePatrimonioFormBtn')" style="display: flex; align-items: center; gap: 8px;">
                            <span id="patrimonioFormText">Nueva Propiedad</span>
                        </button>
                    </div>
                    <div style="background: var(--bg-primary); padding: 24px; border-radius: var(--radius); border: 1px solid var(--border-color); box-shadow: var(--shadow-light); margin-bottom: 24px; color: var(--text-primary);">
                        <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 20px;">Registra tus propiedades (viviendas, veh√≠culos, oficinas, etc.) y as√≥cialas con pr√©stamos. Haz seguimiento de la evoluci√≥n de su valor a lo largo del tiempo.</p>
                    </div>
                    <form id="patrimonioForm" style="display: none; background: var(--bg-primary); padding: 24px; border-radius: var(--radius); border: 1px solid var(--border-color); box-shadow: var(--shadow-light); color: var(--text-primary);">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="patrimonioName">Nombre de la Propiedad</label>
                                <input type="text" id="patrimonioName" placeholder="Ej: Piso Calle Mayor 5, Coche Toyota" required>
                            </div>
                            <div class="form-group">
                                <label for="patrimonioType">Tipo de Propiedad</label>
                                <select id="patrimonioType" required>
                                    <option value="apartment">Apartamento</option>
                                    <option value="house">Casa</option>
                                    <option value="office">Oficina</option>
                                    <option value="commercial">Comercial</option>
                                    <option value="vehicle">Veh√≠culo</option>
                                    <option value="jewelry">Joyas</option>
                                    <option value="art">Arte</option>
                                    <option value="electronics">Electr√≥nica</option>
                                    <option value="other">Otro</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="patrimonioAddress">Direcci√≥n (Opcional)</label>
                                <input type="text" id="patrimonioAddress" placeholder="Ej: Calle Mayor 123, Madrid">
                            </div>
                            <div class="form-group">
                                <label for="patrimonioLocation">Ubicaci√≥n General (Opcional)</label>
                                <input type="text" id="patrimonioLocation" placeholder="Ej: Madrid, Espa√±a">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="patrimonioPurchaseDate">Fecha de Adquisici√≥n (Opcional)</label>
                                <input type="date" id="patrimonioPurchaseDate">
                            </div>
                            <div class="form-group">
                                <label for="patrimonioPurchasePrice">Precio de Compra (‚Ç¨)</label>
                                <input type="number" id="patrimonioPurchasePrice" step="0.01" min="0" value="0">
                        </div>
                            <div class="form-group">
                                <label for="patrimonioCurrentValue">Valor Actual (‚Ç¨) *</label>
                                <input type="number" id="patrimonioCurrentValue" step="0.01" min="0" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group" style="flex: 2;">
                                <label for="patrimonioDescription">Descripci√≥n (Opcional)</label>
                                <input type="text" id="patrimonioDescription" placeholder="Ej: Piso de 80m¬≤, 3 habitaciones">
                            </div>
                        </div>
                        <button type="submit" class="btn-primary">Agregar Propiedad</button>
                    </form>
                </div>
                <div class="assets-grid" id="patrimonioGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; margin-top: 30px;">
                </div>
            </div>

            <!-- Tab: An√°lisis -->
            <div class="tab-content" id="charts-tab">
                <!-- Gr√°ficas -->
                <div>
                    <h2 style="font-size: 20px; font-weight: 700; margin-bottom: 20px; color: var(--text-primary);">Gr√°ficas</h2>
                <div class="charts-container">
                    <div class="chart-card" onclick="openChartModal('savings', 'Evoluci√≥n de Ahorro')" style="cursor: pointer;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; flex-wrap: wrap; gap: 8px;">
                            <h3>Evoluci√≥n de Ahorro</h3>
                            <select class="chart-period-select" data-chart="savings" onclick="event.stopPropagation();">
                                <option value="1">1 mes</option>
                                <option value="3">3 meses</option>
                                <option value="6" selected>6 meses</option>
                                <option value="12">1 a√±o</option>
                                <option value="24">2 a√±os</option>
                                <option value="all">Todo</option>
                                <option value="custom">Fecha personalizada</option>
                            </select>
                        </div>
                        <div id="savingsCustomDateRange" style="display: none; margin-bottom: 12px; gap: 8px; flex-wrap: wrap; flex-direction: row;" onclick="event.stopPropagation();">
                            <input type="date" id="savingsStartDate" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; flex: 1; min-width: 140px;">
                            <input type="date" id="savingsEndDate" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; flex: 1; min-width: 140px;">
                        </div>
                        <canvas id="savingsChart"></canvas>
                    </div>
                    <div class="chart-card" onclick="openChartModal('expenses', 'Gastos por Categor√≠a')" style="cursor: pointer;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; flex-wrap: wrap; gap: 8px;">
                            <h3>Gastos por Categor√≠a</h3>
                            <select class="chart-period-select" data-chart="expenses" onclick="event.stopPropagation();">
                                <option value="1">1 mes</option>
                                <option value="3">3 meses</option>
                                <option value="6" selected>6 meses</option>
                                <option value="12">1 a√±o</option>
                                <option value="24">2 a√±os</option>
                                <option value="all">Todo</option>
                                <option value="custom">Fecha personalizada</option>
                            </select>
                        </div>
                        <div id="expensesCustomDateRange" style="display: none; margin-bottom: 12px; gap: 8px; flex-wrap: wrap; flex-direction: row;" onclick="event.stopPropagation();">
                            <input type="date" id="expensesStartDate" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; flex: 1; min-width: 140px;">
                            <input type="date" id="expensesEndDate" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; flex: 1; min-width: 140px;">
                        </div>
                        <canvas id="expensesChart"></canvas>
                    </div>
                    <div class="chart-card" onclick="openChartModal('incomeExpense', 'Ingresos vs Gastos')" style="cursor: pointer;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; flex-wrap: wrap; gap: 8px;">
                            <h3>Ingresos vs Gastos</h3>
                            <select class="chart-period-select" data-chart="incomeExpense" onclick="event.stopPropagation();">
                                <option value="1">1 mes</option>
                                <option value="3">3 meses</option>
                                <option value="6" selected>6 meses</option>
                                <option value="12">1 a√±o</option>
                                <option value="24">2 a√±os</option>
                                <option value="all">Todo</option>
                                <option value="custom">Fecha personalizada</option>
                            </select>
                        </div>
                        <div id="incomeExpenseCustomDateRange" style="display: none; margin-bottom: 12px; gap: 8px; flex-wrap: wrap; flex-direction: row;" onclick="event.stopPropagation();">
                            <input type="date" id="incomeExpenseStartDate" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; flex: 1; min-width: 140px;">
                            <input type="date" id="incomeExpenseEndDate" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; flex: 1; min-width: 140px;">
                        </div>
                        <canvas id="incomeExpenseChart"></canvas>
                    </div>
                    <div class="chart-card" onclick="openChartModal('distribution', 'Distribuci√≥n de Gastos')" style="cursor: pointer;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; flex-wrap: wrap; gap: 8px;">
                            <h3>Distribuci√≥n de Gastos</h3>
                            <select class="chart-period-select" data-chart="distribution" onclick="event.stopPropagation();">
                                <option value="1">1 mes</option>
                                <option value="3">3 meses</option>
                                <option value="6" selected>6 meses</option>
                                <option value="12">1 a√±o</option>
                                <option value="24">2 a√±os</option>
                                <option value="all">Todo</option>
                                <option value="custom">Fecha personalizada</option>
                            </select>
                        </div>
                        <div id="distributionCustomDateRange" style="display: none; margin-bottom: 12px; gap: 8px; flex-wrap: wrap; flex-direction: row;" onclick="event.stopPropagation();">
                            <input type="date" id="distributionStartDate" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; flex: 1; min-width: 140px;">
                            <input type="date" id="distributionEndDate" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; flex: 1; min-width: 140px;">
                        </div>
                        <canvas id="distributionChart"></canvas>
                    </div>
                    <div class="chart-card" onclick="openChartModal('incomeEvolution', 'Evoluci√≥n de Ingresos')" style="cursor: pointer;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; flex-wrap: wrap; gap: 8px;">
                            <h3>Evoluci√≥n de Ingresos</h3>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <select class="chart-period-select" data-chart="incomeEvolution" onclick="event.stopPropagation();">
                                    <option value="1">1 mes</option>
                                    <option value="3">3 meses</option>
                                    <option value="6" selected>6 meses</option>
                                    <option value="12">1 a√±o</option>
                                    <option value="24">2 a√±os</option>
                                    <option value="all">Todo</option>
                                    <option value="custom">Fecha personalizada</option>
                                </select>
                                <select class="chart-category-filter" data-chart="incomeEvolution" onclick="event.stopPropagation();">
                                    <option value="all">Todas las categor√≠as</option>
                                </select>
                            </div>
                        </div>
                        <div id="incomeEvolutionCustomDateRange" style="display: none; margin-bottom: 12px; gap: 8px; flex-wrap: wrap; flex-direction: row;" onclick="event.stopPropagation();">
                            <input type="date" id="incomeEvolutionStartDate" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; flex: 1; min-width: 140px;">
                            <input type="date" id="incomeEvolutionEndDate" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; flex: 1; min-width: 140px;">
                        </div>
                        <canvas id="incomeEvolutionChart"></canvas>
                    </div>
                    <div class="chart-card" onclick="openChartModal('expensesEvolution', 'Evoluci√≥n de Gastos')" style="cursor: pointer;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; flex-wrap: wrap; gap: 8px;">
                            <h3>Evoluci√≥n de Gastos</h3>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <select class="chart-period-select" data-chart="expensesEvolution" onclick="event.stopPropagation();">
                                    <option value="1">1 mes</option>
                                    <option value="3">3 meses</option>
                                    <option value="6" selected>6 meses</option>
                                    <option value="12">1 a√±o</option>
                                    <option value="24">2 a√±os</option>
                                    <option value="all">Todo</option>
                                    <option value="custom">Fecha personalizada</option>
                                </select>
                                <select class="chart-category-filter" data-chart="expensesEvolution" onclick="event.stopPropagation();">
                                    <option value="all">Todas las categor√≠as</option>
                                </select>
                            </div>
                        </div>
                        <div id="expensesEvolutionCustomDateRange" style="display: none; margin-bottom: 12px; gap: 8px; flex-wrap: wrap; flex-direction: row;" onclick="event.stopPropagation();">
                            <input type="date" id="expensesEvolutionStartDate" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; flex: 1; min-width: 140px;">
                            <input type="date" id="expensesEvolutionEndDate" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; flex: 1; min-width: 140px;">
                        </div>
                        <canvas id="expensesEvolutionChart"></canvas>
                    </div>
                    <div class="chart-card" onclick="openChartModal('loansPending', 'Evoluci√≥n de Deuda')" style="cursor: pointer;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; flex-wrap: wrap; gap: 8px;">
                            <h3>Pr√©stamos Pendientes</h3>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <select class="chart-period-select" data-chart="loansPending" onclick="event.stopPropagation();">
                                    <option value="1">1 mes</option>
                                    <option value="3">3 meses</option>
                                    <option value="6" selected>6 meses</option>
                                    <option value="12">1 a√±o</option>
                                    <option value="24">2 a√±os</option>
                                    <option value="60">5 a√±os</option>
                                    <option value="120">10 a√±os</option>
                                    <option value="180">15 a√±os</option>
                                    <option value="240">20 a√±os</option>
                                    <option value="300">25 a√±os</option>
                                    <option value="360">30 a√±os</option>
                                    <option value="all">Todo</option>
                                    <option value="custom">Fecha personalizada</option>
                                </select>
                                <select class="chart-loan-filter" data-chart="loansPending" onclick="event.stopPropagation();">
                                    <option value="all">Todos los pr√©stamos</option>
                                </select>
                            </div>
                        </div>
                        <div id="loansPendingCustomDateRange" style="display: none; margin-bottom: 12px; gap: 8px; flex-wrap: wrap; flex-direction: row;" onclick="event.stopPropagation();">
                            <input type="date" id="loansPendingStartDate" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; flex: 1; min-width: 140px;">
                            <input type="date" id="loansPendingEndDate" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; flex: 1; min-width: 140px;">
                        </div>
                        <canvas id="loansPendingChart"></canvas>
                    </div>
                    <div class="chart-card" onclick="openChartModal('assetsEvolution', 'Evoluci√≥n del Patrimonio')" style="cursor: pointer;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; flex-wrap: wrap; gap: 8px;">
                            <h3>Evoluci√≥n del Patrimonio</h3>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <select class="chart-period-select" data-chart="assetsEvolution" onclick="event.stopPropagation();">
                                    <option value="1">1 mes</option>
                                    <option value="3">3 meses</option>
                                    <option value="6" selected>6 meses</option>
                                    <option value="12">1 a√±o</option>
                                    <option value="24">2 a√±os</option>
                                    <option value="60">5 a√±os</option>
                                    <option value="120">10 a√±os</option>
                                    <option value="180">15 a√±os</option>
                                    <option value="240">20 a√±os</option>
                                    <option value="300">25 a√±os</option>
                                    <option value="360">30 a√±os</option>
                                    <option value="all">Todo</option>
                                    <option value="custom">Fecha personalizada</option>
                                </select>
                                <select class="chart-asset-filter" data-chart="assetsEvolution" onclick="event.stopPropagation();">
                                    <option value="all">Todos los bienes</option>
                                </select>
                            </div>
                        </div>
                        <div id="assetsEvolutionCustomDateRange" style="display: none; margin-bottom: 12px; gap: 8px; flex-wrap: wrap; flex-direction: row;" onclick="event.stopPropagation();">
                            <input type="date" id="assetsEvolutionStartDate" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; flex: 1; min-width: 140px;">
                            <input type="date" id="assetsEvolutionEndDate" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; flex: 1; min-width: 140px;">
                        </div>
                        <canvas id="assetsEvolutionChart"></canvas>
                    </div>
                    <div class="chart-card" onclick="openChartModal('accountsBalance', 'Evoluci√≥n de Saldo en Cuentas')" style="cursor: pointer;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; flex-wrap: wrap; gap: 8px;">
                            <h3>Evoluci√≥n de Saldo en Cuentas</h3>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <select class="chart-period-select" data-chart="accountsBalance" onclick="event.stopPropagation();">
                                    <option value="1">1 mes</option>
                                    <option value="3">3 meses</option>
                                    <option value="6" selected>6 meses</option>
                                    <option value="12">1 a√±o</option>
                                    <option value="24">2 a√±os</option>
                                    <option value="all">Todo</option>
                                    <option value="custom">Fecha personalizada</option>
                                </select>
                                <select class="chart-account-filter" data-chart="accountsBalance" onclick="event.stopPropagation();">
                                    <option value="all">Todas las cuentas</option>
                                </select>
                            </div>
                        </div>
                        <div id="accountsBalanceCustomDateRange" style="display: none; margin-bottom: 12px; gap: 8px; flex-wrap: wrap; flex-direction: row;" onclick="event.stopPropagation();">
                            <input type="date" id="accountsBalanceStartDate" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; flex: 1; min-width: 140px;">
                            <input type="date" id="accountsBalanceEndDate" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; flex: 1; min-width: 140px;">
                        </div>
                        <canvas id="accountsBalanceChart"></canvas>
                    </div>
                </div>
                </div>
                
                <div style="margin-bottom: 32px;">
                    <h2 style="font-size: 20px; font-weight: 700; margin-bottom: 24px; color: var(--text-primary);">Indicadores de Salud Financiera</h2>
                    <div id="financialHealthMetrics" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 32px;">
                        <!-- Se llenar√° din√°micamente -->
                    </div>
                </div>
                
                <!-- Escenarios de Ahorro -->
                <div style="margin-bottom: 32px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 12px;">
                        <h2 style="font-size: clamp(18px, 4vw, 20px); font-weight: 700; margin: 0; color: var(--text-primary);">Escenarios de Ahorro</h2>
                    </div>
                    <div id="savingsScenariosContainer" style="width: 100%;">
                        <!-- Se llenar√° din√°micamente -->
                    </div>
                </div>
                
                <!-- Recomendaciones Econ√≥micas -->
                <div style="margin-bottom: 32px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 12px;">
                        <h2 style="font-size: clamp(18px, 4vw, 20px); font-weight: 700; margin: 0; color: var(--text-primary);">Recomendaciones Personalizadas</h2>
                        <button id="refreshRecommendationsBtn" onclick="updateRecommendations()" style="padding: clamp(6px, 1.5vw, 8px) clamp(12px, 3vw, 16px); background: var(--primary); color: white; border: none; border-radius: 8px; font-size: clamp(11px, 2.5vw, 13px); font-weight: 600; cursor: pointer; transition: all 0.2s; white-space: nowrap;" onmouseover="this.style.background='var(--primary-dark)'" onmouseout="this.style.background='var(--primary)'">Actualizar</button>
                    </div>
                    <div id="recommendationsContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(min(100%, 300px), 1fr)); gap: 16px;">
                        <!-- Se llenar√° din√°micamente -->
                        </div>
                    </div>
                
                <!-- Tablas de An√°lisis -->
                <div style="margin-bottom: 32px;">
                    <h2 style="font-size: 20px; font-weight: 700; margin-bottom: 20px; color: var(--text-primary);">An√°lisis Detallado</h2>
                    
                    <!-- Gastos Recurrentes -->
                    <div class="table-section" style="margin-bottom: 32px;">
                        <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: var(--text-primary);">Gastos Recurrentes</h3>
                        <div class="table-container">
                            <table id="recurringExpensesTable">
                                <thead>
                                    <tr>
                                        <th>Categor√≠a</th>
                                        <th>Frecuencia</th>
                                        <th>Promedio Mensual</th>
                                        <th>Total Per√≠odo</th>
                                    </tr>
                                </thead>
                                <tbody id="recurringExpensesBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Comparativa Mensual -->
                    <div class="table-section" style="margin-bottom: 32px;">
                        <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: var(--text-primary);">Comparativa Mensual</h3>
                        <div class="table-container">
                            <table id="monthlyComparisonTable">
                                <thead>
                                    <tr>
                                        <th>Mes</th>
                                        <th>Ingresos</th>
                                        <th>Gastos</th>
                                        <th>Ahorro</th>
                                        <th>% Ahorro</th>
                                    </tr>
                                </thead>
                                <tbody id="monthlyComparisonBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- An√°lisis por Categor√≠a -->
                    <div class="table-section" style="margin-bottom: 32px;">
                        <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: var(--text-primary);">An√°lisis por Categor√≠a</h3>
                        <div class="table-container">
                            <table id="categoryAnalysisTable">
                                <thead>
                                    <tr>
                                        <th>Categor√≠a</th>
                                        <th>Total</th>
                                        <th>% del Total</th>
                                        <th>Promedio Mensual</th>
                                        <th>Transacciones</th>
                                    </tr>
                                </thead>
                                <tbody id="categoryAnalysisBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Detalles de Categor√≠a -->
    <div id="categoryDetailsModal" class="modal" style="display: none; z-index: 10002;">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh; padding: 0; overflow: hidden; display: flex; flex-direction: column;">
            <div class="rainbow-bg" style="padding: 24px 32px; position: sticky; top: 0; z-index: 10; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 id="categoryDetailsModalTitle" style="margin: 0; font-size: 24px; font-weight: 700;">Detalles de Categor√≠a</h2>
                    <button onclick="closeCategoryDetailsModal()" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 12px; border-radius: 50%; cursor: pointer; font-size: 18px; font-weight: 300; transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">√ó</button>
                </div>
            </div>
            <div style="padding: 24px 32px; flex: 1; overflow-y: auto;">
                <div id="categoryDetailsContent"></div>
            </div>
        </div>
    </div>

    <!-- Modal de Gr√°fico Detallado -->
    <div id="chartModal" class="modal" style="display: none;">
        <div class="modal-content chart-modal-content" style="max-width: 90vw; max-height: 90vh; width: 1200px; padding: 0; overflow: hidden; display: flex; flex-direction: column;">
            <div class="chart-modal-header rainbow-bg" style="padding: 24px 32px; position: sticky; top: 0; z-index: 10; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 id="chartModalTitle" class="chart-modal-title" style="margin: 0; font-size: 24px; font-weight: 700;">Gr√°fico</h2>
                    <button onclick="closeChartModal()" class="chart-modal-close" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 12px; border-radius: 50%; cursor: pointer; font-size: 18px; font-weight: 300; transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">√ó</button>
                </div>
            </div>
            <div class="chart-modal-body" style="padding: 24px 32px; flex: 1; overflow-y: auto; overflow-x: hidden;">
                <div id="chartModalControls" class="chart-modal-controls" style="margin-bottom: 24px; display: flex; gap: 16px; flex-wrap: wrap; align-items: center; padding: 16px; background: var(--gray-50); border-radius: 8px;">
                    <!-- Controles se llenar√°n din√°micamente -->
                </div>
                <div class="chart-modal-canvas-container" style="position: relative; height: 60vh; min-height: 400px; max-height: 600px; width: 100%; padding: 30px; box-sizing: border-box; margin: 0 auto;">
                    <canvas id="chartModalCanvas"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Perfil de Usuario -->
    <div id="userProfileModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 700px;">
            <div class="rainbow-bg" style="padding: 28px 32px; position: sticky; top: 0; z-index: 10; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 style="margin: 0; font-size: 26px; font-weight: 700; letter-spacing: -0.5px;">Mi Perfil</h2>
                    <button id="closeUserProfileModal" onclick="closeUserProfile()" style="background: rgba(255,255,255,0.2);  border: 1px solid rgba(255,255,255,0.3); color: white; padding: 0; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s; cursor: pointer; font-size: 20px; font-weight: 300;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">√ó</button>
                </div>
            </div>
            
            <form id="userProfileForm" style="padding: 32px; display: flex; flex-direction: column; gap: 24px; max-height: calc(90vh - 100px); overflow-y: auto;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label for="profileFirstName">Nombre</label>
                        <input type="text" id="profileFirstName" placeholder="Tu nombre">
                    </div>
                    <div class="form-group">
                        <label for="profileLastName">Apellidos</label>
                        <input type="text" id="profileLastName" placeholder="Tus apellidos">
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label for="profileAge">Edad</label>
                        <input type="number" id="profileAge" min="1" max="120" placeholder="Tu edad">
                    </div>
                    <div class="form-group">
                        <label for="profileBirthDate">Fecha de Nacimiento</label>
                        <input type="date" id="profileBirthDate">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="profileEmail">Email</label>
                    <input type="email" id="profileEmail" disabled style="background: var(--gray-50); cursor: not-allowed;">
                    <small style="color: var(--gray-500);">El email no se puede cambiar</small>
                </div>
                
                <div class="form-group">
                    <label for="profileUsername">Nombre de Usuario</label>
                    <input type="text" id="profileUsername" disabled style="background: var(--gray-50); cursor: not-allowed;">
                    <small style="color: var(--gray-500);">El nombre de usuario no se puede cambiar</small>
                </div>
                
                <div class="form-group">
                    <label for="profilePhone">Tel√©fono</label>
                    <input type="tel" id="profilePhone" placeholder="+34 600 000 000">
                </div>
                
                <div class="form-group">
                    <label for="profileAddress">Direcci√≥n</label>
                    <input type="text" id="profileAddress" placeholder="Calle, n√∫mero">
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label for="profileCity">Ciudad</label>
                        <input type="text" id="profileCity" placeholder="Tu ciudad">
                    </div>
                    <div class="form-group">
                        <label for="profileCountry">Pa√≠s</label>
                        <input type="text" id="profileCountry" placeholder="Tu pa√≠s">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="profileNotes">Notas Personales</label>
                    <textarea id="profileNotes" rows="4" placeholder="Cualquier informaci√≥n adicional que quieras guardar..." style="width: 100%; padding: 10px 12px; border: 1.5px solid var(--gray-300); border-radius: var(--radius); font-size: 14px; font-family: inherit; resize: vertical;"></textarea>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: space-between; margin-top: 24px; padding-top: 24px; padding-bottom: 8px; border-top: 1px solid var(--border-color);">
                    <button type="button" class="btn-danger" onclick="deleteUserAccount(); return false;" style="background: #ef4444; color: white; border: none;">Eliminar Cuenta</button>
                    <div style="display: flex; gap: 12px;">
                        <button type="button" class="btn-secondary" onclick="closeUserProfile(); return false;">Cancelar</button>
                        <button type="submit" class="btn-primary">üíæ Guardar Cambios</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Detalles de Resumen -->
    <div id="summaryDetailsModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 900px; width: 90vw;">
            <div class="rainbow-bg" style="padding: 28px 32px; position: sticky; top: 0; z-index: 10; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 id="summaryDetailsTitle" style="margin: 0; font-size: 26px; font-weight: 700; letter-spacing: -0.5px;"></h2>
                    <button onclick="closeSummaryDetails()" style="background: rgba(255,255,255,0.2);  border: 1px solid rgba(255,255,255,0.3); color: white; padding: 0; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s; cursor: pointer; font-size: 20px; font-weight: 300;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">√ó</button>
                </div>
            </div>
            <div id="summaryDetailsContent" style="padding: 20px 24px; line-height: 1.6; color: var(--text-primary); overflow-y: auto; flex: 1; max-height: 60vh; font-size: 14px;"></div>
        </div>
    </div>

    <!-- Modal para Fondo Base -->
    <div id="baseFundModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="rainbow-bg" style="padding: 28px 32px; position: sticky; top: 0; z-index: 10; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 style="margin: 0; font-size: 26px; font-weight: 700; letter-spacing: -0.5px;">Fondo Base</h2>
                    <button onclick="closeBaseFundModal()" style="background: rgba(255,255,255,0.2);  border: 1px solid rgba(255,255,255,0.3); color: white; padding: 0; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s; cursor: pointer; font-size: 20px; font-weight: 300;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">√ó</button>
                </div>
            </div>
            <div style="padding: 32px;">
                <form id="baseFundForm" style="display: flex; flex-direction: column; gap: 20px;">
                    <div class="form-group">
                        <label for="baseFundInput">Establece tu fondo base (en euros)</label>
                        <input type="number" id="baseFundInput" min="0" step="0.01" placeholder="Ej: 5000" style="width: 100%; padding: 14px 18px; border: 1.5px solid var(--border-color); border-radius: 10px; font-size: 15px;">
                        <small style="color: var(--text-tertiary); font-size: 12px; margin-top: 6px;">Cantidad base que deseas mantener disponible</small>
                    </div>
                    <div style="display: flex; gap: 12px; justify-content: flex-end;">
                        <button type="button" class="btn-secondary" onclick="closeBaseFundModal()">Cancelar</button>
                        <button type="button" class="btn-secondary" onclick="deleteBaseFund()" style="background: var(--danger); color: white; border-color: var(--danger);">Eliminar Fondo</button>
                        <button type="submit" class="btn-primary">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para A√±adir Dinero a Inversi√≥n -->
    <div id="addMoneyInvestmentModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="rainbow-bg" style="padding: 28px 32px; position: sticky; top: 0; z-index: 10; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 id="addMoneyInvestmentTitle" style="margin: 0; font-size: 26px; font-weight: 700; letter-spacing: -0.5px;">A√±adir Dinero</h2>
                    <button onclick="closeAddMoneyInvestmentModal()" style="background: rgba(255,255,255,0.2);  border: 1px solid rgba(255,255,255,0.3); color: white; padding: 0; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s; cursor: pointer; font-size: 20px; font-weight: 300;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">√ó</button>
                </div>
            </div>
            <div style="padding: 32px;">
                <div id="addMoneyInvestmentInfo" style="background: var(--bg-tertiary); padding: 16px; border-radius: 10px; margin-bottom: 20px; color: var(--text-primary); border: 1px solid var(--border-color);"></div>
                <form id="addMoneyInvestmentForm" style="display: flex; flex-direction: column; gap: 20px;">
                    <div class="form-group">
                        <label for="addMoneyAmount">Cantidad a a√±adir (‚Ç¨)</label>
                        <input type="number" id="addMoneyAmount" min="0" step="0.01" placeholder="0.00" style="width: 100%; padding: 14px 18px; border: 1.5px solid var(--border-color); border-radius: 10px; font-size: 15px;">
                    </div>
                    <div style="display: flex; gap: 12px; justify-content: flex-end;">
                        <button type="button" class="btn-secondary" onclick="closeAddMoneyInvestmentModal()">Cancelar</button>
                        <button type="submit" class="btn-primary">A√±adir</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para Actualizar Valor de Inversi√≥n -->
    <div id="updateInvestmentValueModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="rainbow-bg" style="padding: 28px 32px; position: sticky; top: 0; z-index: 10; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 id="updateInvestmentValueTitle" style="margin: 0; font-size: 26px; font-weight: 700; letter-spacing: -0.5px;">Actualizar Valor</h2>
                    <button onclick="closeUpdateInvestmentValueModal()" style="background: rgba(255,255,255,0.2);  border: 1px solid rgba(255,255,255,0.3); color: white; padding: 0; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s; cursor: pointer; font-size: 20px; font-weight: 300;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">√ó</button>
                </div>
            </div>
            <div style="padding: 32px;">
                <form id="updateInvestmentValueForm" style="display: flex; flex-direction: column; gap: 20px;">
                    <div class="form-group">
                        <label for="updateInvestmentValueInput">Nuevo valor (‚Ç¨)</label>
                        <input type="number" id="updateInvestmentValueInput" min="0" step="0.01" placeholder="0.00" style="width: 100%; padding: 14px 18px; border: 1.5px solid var(--border-color); border-radius: 10px; font-size: 15px;">
                    </div>
                    <div style="display: flex; gap: 12px; justify-content: flex-end;">
                        <button type="button" class="btn-secondary" onclick="closeUpdateInvestmentValueModal()">Cancelar</button>
                        <button type="submit" class="btn-primary">Actualizar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para Actualizar Saldo de Cuenta -->
    <div id="updateAccountBalanceModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="rainbow-bg" style="padding: 28px 32px; position: sticky; top: 0; z-index: 10; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 id="updateAccountBalanceTitle" style="margin: 0; font-size: 26px; font-weight: 700; letter-spacing: -0.5px;">Actualizar Saldo</h2>
                    <button onclick="closeUpdateAccountBalanceModal()" style="background: rgba(255,255,255,0.2);  border: 1px solid rgba(255,255,255,0.3); color: white; padding: 0; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s; cursor: pointer; font-size: 20px; font-weight: 300;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">√ó</button>
                </div>
            </div>
            <div style="padding: 32px;">
                <form id="updateAccountBalanceForm" style="display: flex; flex-direction: column; gap: 20px;">
                    <div class="form-group">
                        <label for="updateAccountBalanceInput">Nuevo saldo (‚Ç¨)</label>
                        <input type="number" id="updateAccountBalanceInput" step="0.01" placeholder="0.00" style="width: 100%; padding: 14px 18px; border: 1.5px solid var(--border-color); border-radius: 10px; font-size: 15px;">
                    </div>
                    <div style="display: flex; gap: 12px; justify-content: flex-end;">
                        <button type="button" class="btn-secondary" onclick="closeUpdateAccountBalanceModal()">Cancelar</button>
                        <button type="submit" class="btn-primary">Actualizar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para Actualizar Valor de Bien -->
    <div id="updateAssetValueModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="rainbow-bg" style="padding: 28px 32px; position: sticky; top: 0; z-index: 10; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 id="updateAssetValueTitle" style="margin: 0; font-size: 26px; font-weight: 700; letter-spacing: -0.5px;">Actualizar Valor</h2>
                    <button onclick="closeUpdateAssetValueModal()" style="background: rgba(255,255,255,0.2);  border: 1px solid rgba(255,255,255,0.3); color: white; padding: 0; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s; cursor: pointer; font-size: 20px; font-weight: 300;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">√ó</button>
                </div>
            </div>
            <div style="padding: 32px;">
                <form id="updateAssetValueForm" style="display: flex; flex-direction: column; gap: 20px;">
                    <div class="form-group">
                        <label for="updateAssetValueInput">Nuevo valor actual (‚Ç¨)</label>
                        <input type="number" id="updateAssetValueInput" min="0" step="0.01" placeholder="0.00" style="width: 100%; padding: 14px 18px; border: 1.5px solid var(--border-color); border-radius: 10px; font-size: 15px;">
                    </div>
                    <div style="display: flex; gap: 12px; justify-content: flex-end;">
                        <button type="button" class="btn-secondary" onclick="closeUpdateAssetValueModal()">Cancelar</button>
                        <button type="submit" class="btn-primary">Actualizar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para Actualizar Valor de Propiedad -->
    <div id="updatePropertyValueModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="rainbow-bg" style="padding: 28px 32px; position: sticky; top: 0; z-index: 10; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 id="updatePropertyValueTitle" style="margin: 0; font-size: 26px; font-weight: 700; letter-spacing: -0.5px;">Actualizar Valor</h2>
                    <button onclick="closeUpdatePropertyValueModal()" style="background: rgba(255,255,255,0.2);  border: 1px solid rgba(255,255,255,0.3); color: white; padding: 0; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s; cursor: pointer; font-size: 20px; font-weight: 300;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">√ó</button>
                </div>
            </div>
            <div style="padding: 32px;">
                <form id="updatePropertyValueForm" style="display: flex; flex-direction: column; gap: 20px;">
                    <div class="form-group">
                        <label for="updatePropertyValueInput">Nuevo valor actual (‚Ç¨)</label>
                        <input type="number" id="updatePropertyValueInput" min="0" step="0.01" placeholder="0.00" style="width: 100%; padding: 14px 18px; border: 1.5px solid var(--border-color); border-radius: 10px; font-size: 15px;">
                    </div>
                    <div style="display: flex; gap: 12px; justify-content: flex-end;">
                        <button type="button" class="btn-secondary" onclick="closeUpdatePropertyValueModal()">Cancelar</button>
                        <button type="submit" class="btn-primary">Actualizar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modales de Pol√≠ticas -->
    <div id="privacyModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 700px; max-height: 85vh;">
            <div class="rainbow-bg" style="padding: 20px 24px; position: sticky; top: 0; z-index: 10; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 class="modal-policy-title" style="margin: 0; font-size: 20px; font-weight: 700; letter-spacing: -0.5px;">üîí Pol√≠tica de Privacidad</h2>
                    <button onclick="closePrivacyModal()" style="background: rgba(255,255,255,0.2);  border: 1px solid rgba(255,255,255,0.3); color: white; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s; cursor: pointer; font-size: 18px; font-weight: 300;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">√ó</button>
                </div>
            </div>
            <div id="privacyContent" class="modal-policy-content" style="padding: 24px; line-height: 1.8; color: var(--text-primary); overflow-y: auto; max-height: calc(85vh - 80px); font-size: 15px;"></div>
        </div>
    </div>

    <div id="cookiesModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 700px; max-height: 85vh;">
            <div class="rainbow-bg" style="padding: 20px 24px; position: sticky; top: 0; z-index: 10; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 class="modal-policy-title" style="margin: 0; font-size: 20px; font-weight: 700; letter-spacing: -0.5px;">üç™ Pol√≠tica de Cookies</h2>
                    <button onclick="closeCookiesModal()" style="background: rgba(255,255,255,0.2);  border: 1px solid rgba(255,255,255,0.3); color: white; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s; cursor: pointer; font-size: 18px; font-weight: 300;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">√ó</button>
                </div>
            </div>
            <div id="cookiesContent" class="modal-policy-content" style="padding: 24px; line-height: 1.8; color: var(--text-primary); overflow-y: auto; max-height: calc(85vh - 80px); font-size: 15px;"></div>
        </div>
    </div>

    <div id="termsModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 700px; max-height: 85vh;">
            <div class="rainbow-bg" style="padding: 20px 24px; position: sticky; top: 0; z-index: 10; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 class="modal-policy-title" style="margin: 0; font-size: 20px; font-weight: 700; letter-spacing: -0.5px;">T√©rminos y Condiciones</h2>
                    <button onclick="closeTermsModal()" style="background: rgba(255,255,255,0.2);  border: 1px solid rgba(255,255,255,0.3); color: white; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s; cursor: pointer; font-size: 18px; font-weight: 300;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">√ó</button>
                </div>
            </div>
            <div id="termsContent" class="modal-policy-content" style="padding: 24px; line-height: 1.8; color: var(--text-primary); overflow-y: auto; max-height: calc(85vh - 80px); font-size: 15px;"></div>
        </div>
    </div>

    <!-- Cargar aplicaci√≥n JavaScript directamente -->
    <script src="app.js?v=2.25.0"></script>
    
    <!-- Footer (solo visible en la app principal, no en welcome page) -->
    <footer id="mainFooter" style="background: transparent; color: rgba(255,255,255,0.9); padding: 16px 0; margin-top: 40px; border-top: none; box-shadow: none; display: none;" class="main-footer">
        <div style="width: 100%; padding: 0 24px; box-sizing: border-box;">
            <div style="display: grid; grid-template-columns: 1fr auto; gap: 24px; margin-bottom: 16px; align-items: flex-start;">
                <div>
                    <h3 style="margin-bottom: 8px; font-size: 14px;">
                    </h3>
                    <p style="font-size: 11px; line-height: 1.4; margin: 0;">
                        La cuenta de la vieja, pero digital.
                    </p>
                </div>
                <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 8px;">
                    <h4 style="margin: 0; font-size: 13px; font-weight: 600;">Enlaces</h4>
                    <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 6px;">
                        <a href="javascript:void(0);" onclick="if(typeof showPrivacyModal === 'function') { showPrivacyModal(); } else { console.error('showPrivacyModal no est√° definida'); } return false;" style="text-decoration: none; font-size: 11px; transition: color 0.2s; cursor: pointer; white-space: nowrap;" class="footer-link">Pol√≠tica de Privacidad</a>
                        <a href="javascript:void(0);" onclick="if(typeof showCookiesModal === 'function') { showCookiesModal(); } else { console.error('showCookiesModal no est√° definida'); } return false;" style="text-decoration: none; font-size: 11px; transition: color 0.2s; cursor: pointer; white-space: nowrap;" class="footer-link">Pol√≠tica de Cookies</a>
                        <a href="javascript:void(0);" onclick="if(typeof showTermsModal === 'function') { showTermsModal(); } else { console.error('showTermsModal no est√° definida'); } return false;" style="text-decoration: none; font-size: 11px; transition: color 0.2s; cursor: pointer; white-space: nowrap;" class="footer-link">T√©rminos y Condiciones</a>
                    </div>
                </div>
            </div>
            <div style="border-top: 1px solid rgba(0,0,0,0.1); padding-top: 12px; text-align: center;">
                <p style="font-size: 10px; margin: 0;" class="footer-copyright">
                    ¬© 2025 <strong>Pablo Beneitez</strong>. Todos los derechos reservados.
                </p>
            </div>
        </div>
    </footer>

    <!-- Sistema de Notificaciones Toast -->
    <div id="toastContainer" style="position: fixed; top: 20px; right: 20px; z-index: 10000; display: flex; flex-direction: column; gap: 12px; pointer-events: none;"></div>

    <!-- Modal de Confirmaci√≥n -->
    <div id="confirmModal" class="modal" style="display: none; z-index: 10001;">
        <div class="modal-content" style="max-width: 500px; padding: 0;">
            <div class="rainbow-bg" style="padding: 24px 32px; border-radius: 12px 12px 0 0;">
                <h2 id="confirmModalTitle" style="margin: 0; font-size: 20px; font-weight: 700;">Confirmar acci√≥n</h2>
            </div>
            <div style="padding: 24px 32px; background: var(--bg-primary); color: var(--text-primary);">
                <p id="confirmModalMessage" style="margin: 0 0 24px 0; color: var(--text-primary); font-size: 15px; line-height: 1.6;"></p>
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="confirmModalCancel" class="btn-secondary" style="min-width: 100px;">Cancelar</button>
                    <button id="confirmModalConfirm" class="btn-primary" style="min-width: 100px;">Confirmar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Spinner de carga global -->
    <div id="globalLoader" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); z-index: 9999; align-items: center; justify-content: center; ">
        <div style="background: var(--bg-primary); padding: 32px; border-radius: 16px; display: flex; flex-direction: column; align-items: center; gap: 16px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); border: 1px solid var(--border-color);">
            <div class="spinner" style="width: 48px; height: 48px; border: 4px solid var(--gray-200); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite;"></div>
            <p style="margin: 0; color: var(--text-primary); font-size: 14px; font-weight: 500;" id="globalLoaderText">Cargando...</p>
        </div>
    </div>
    
    <!-- Bot√≥n Flotante Contextual (M√≥vil) - Se actualiza seg√∫n la secci√≥n activa -->
    <button id="quickAddTransactionBtnMobile" class="quick-add-btn-mobile" style="display: none; position: fixed; bottom: 24px; right: 24px; width: 56px; height: 56px; padding: 0; background: var(--bg-primary); border: 2px solid var(--border-color); border-radius: 50%; color: var(--text-primary); font-size: 28px; font-weight: 400; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15), 0 2px 4px rgba(0, 0, 0, 0.1); z-index: 999; align-items: center; justify-content: center; box-sizing: border-box; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);" onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 16px rgba(0, 0, 0, 0.2), 0 3px 6px rgba(0, 0, 0, 0.15)';" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 12px rgba(0, 0, 0, 0.15), 0 2px 4px rgba(0, 0, 0, 0.1)';" title="Nueva Transacci√≥n">
        <span style="line-height: 1; display: flex; align-items: center; justify-content: center;">+</span>
    </button>
    
    <!-- Barra de secciones fija en la parte inferior para m√≥vil -->
    <div class="mobile-bottom-tabs" id="mobileBottomTabs">
        <button class="tab-btn" data-tab="transactions">
            <span class="tab-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                    <line x1="1" y1="10" x2="23" y2="10"></line>
                </svg>
            </span>
            <span class="tab-text" data-translate="nav.transactions">Transacciones</span>
        </button>
        <button class="tab-btn" data-tab="summary">
            <span class="tab-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 3v18h18"></path>
                    <path d="M18 7l-5 5-4-4-3 3"></path>
                </svg>
            </span>
            <span class="tab-text">Resumen</span>
        </button>
        <button class="tab-btn" data-tab="accounts">
            <span class="tab-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                    <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                </svg>
            </span>
            <span class="tab-text" data-translate="nav.accounts">Cuentas</span>
        </button>
        <button class="tab-btn" data-tab="envelopes">
            <span class="tab-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="8" width="18" height="12" rx="2"></rect>
                    <path d="M3 10h18"></path>
                    <path d="M7 15h.01"></path>
                    <path d="M7 18h.01"></path>
                    <path d="M12 15h.01"></path>
                    <path d="M12 18h.01"></path>
                    <path d="M17 15h.01"></path>
                    <path d="M17 18h.01"></path>
                </svg>
            </span>
            <span class="tab-text" data-translate="nav.budgets">Presupuestos</span>
        </button>
        <button class="tab-btn" data-tab="loans">
            <span class="tab-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
            </span>
            <span class="tab-text" data-translate="nav.loans">Pr√©stamos</span>
        </button>
        <button class="tab-btn" data-tab="recurring-expenses">
            <span class="tab-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                    <path d="M8 14h.01M12 14h.01M16 14h.01M8 18h.01M12 18h.01M16 18h.01"></path>
                </svg>
            </span>
            <span class="tab-text">Gastos Recurrentes</span>
        </button>
        <button class="tab-btn" data-tab="investments">
            <span class="tab-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                    <polyline points="17 6 23 6 23 12"></polyline>
                </svg>
            </span>
            <span class="tab-text" data-translate="nav.investments">Inversiones</span>
        </button>
        <button class="tab-btn" data-tab="assets">
            <span class="tab-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
            </span>
            <span class="tab-text" data-translate="nav.assets">Patrimonio</span>
        </button>
        <button class="tab-btn" data-tab="charts">
            <span class="tab-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="20" x2="18" y2="10"></line>
                    <line x1="12" y1="20" x2="12" y2="4"></line>
                    <line x1="6" y1="20" x2="6" y2="14"></line>
                </svg>
            </span>
            <span class="tab-text" data-translate="nav.analysis">An√°lisis</span>
        </button>
    </div>
</body>
</html>


