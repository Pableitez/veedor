<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veedor - Control de Finanzas Personales</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Pantalla de Login/Registro -->
    <div id="authScreen" class="auth-screen">
        <div class="auth-container">
            <div class="auth-header">
                <h1>üí∞ Veedor</h1>
                <p>Control de Finanzas Personales</p>
            </div>
            
            <div class="auth-tabs">
                <button class="auth-tab-btn active" data-auth-tab="login">Iniciar Sesi√≥n</button>
                <button class="auth-tab-btn" data-auth-tab="register">Registrarse</button>
            </div>
            
            <!-- Formulario de Login -->
            <div id="loginForm" class="auth-form active">
                <form id="loginFormElement">
                    <div class="form-group">
                        <label for="loginUsername">Usuario</label>
                        <input type="text" id="loginUsername" required autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Contrase√±a</label>
                        <input type="password" id="loginPassword" required autocomplete="current-password">
                    </div>
                    <button type="submit" class="btn-primary btn-full">Iniciar Sesi√≥n</button>
                    <p id="loginError" class="error-message"></p>
                </form>
            </div>
            
            <!-- Formulario de Registro -->
            <div id="registerForm" class="auth-form">
                <form id="registerFormElement">
                    <div class="form-group">
                        <label for="registerUsername">Usuario</label>
                        <input type="text" id="registerUsername" required autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Contrase√±a</label>
                        <input type="password" id="registerPassword" required autocomplete="new-password" minlength="4">
                        <small>M√≠nimo 4 caracteres</small>
                    </div>
                    <div class="form-group">
                        <label for="registerPasswordConfirm">Confirmar Contrase√±a</label>
                        <input type="password" id="registerPasswordConfirm" required autocomplete="new-password">
                    </div>
                    <button type="submit" class="btn-primary btn-full">Crear Cuenta</button>
                    <p id="registerError" class="error-message"></p>
                </form>
            </div>
        </div>
    </div>

    <!-- Contenido Principal (oculto hasta login) -->
    <div id="mainApp" class="container" style="display: none;">
        <header>
            <h1>Veedor</h1>
            <div class="header-actions">
                <span id="currentUser" class="user-info"></span>
                <button id="switchUserBtn" class="btn-secondary">Cambiar Usuario</button>
                <button id="exportBtn" class="btn-secondary">Exportar CSV</button>
            </div>
        </header>

        <div class="dashboard">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 16px;">
                    <h2 style="font-size: 20px; font-weight: 700; color: var(--gray-900); margin: 0;">Resumen Financiero</h2>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <label style="font-size: 14px; font-weight: 500; color: var(--gray-700);">Per√≠odo:</label>
                        <select id="summaryPeriod" style="padding: 8px 16px; border: 1.5px solid var(--gray-300); border-radius: var(--radius); font-size: 14px; background: white; cursor: pointer; transition: all 0.2s;">
                            <option value="month">Este Mes</option>
                            <option value="year">Este A√±o</option>
                            <option value="all">Todos los Tiempos</option>
                        </select>
                    </div>
                </div>
                <div class="summary-cards">
                    <div class="card">
                        <h3>Balance Total</h3>
                        <p class="amount" id="totalBalance">0,00 ‚Ç¨</p>
                        <small id="totalBalancePeriod">Todos los tiempos</small>
                    </div>
                    <div class="card">
                        <h3>Ingresos</h3>
                        <p class="amount positive" id="periodIncome">0,00 ‚Ç¨</p>
                        <small id="periodIncomeLabel">Este mes</small>
                    </div>
                    <div class="card">
                        <h3>Gastos</h3>
                        <p class="amount negative" id="periodExpenses">0,00 ‚Ç¨</p>
                        <small id="periodExpensesLabel">Este mes</small>
                    </div>
                    <div class="card">
                        <h3>Ahorro</h3>
                        <p class="amount" id="periodSavings">0,00 ‚Ç¨</p>
                        <small id="periodSavingsLabel">Este mes</small>
                    </div>
                    <div class="card" style="background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white; border: none;">
                        <h3 style="color: white;">Meta de Ahorro</h3>
                        <p class="amount" id="savingsGoal" style="color: white;">Sin meta</p>
                        <button id="setSavingsGoalBtn" class="btn-secondary" style="margin-top: 12px; font-size: 13px; padding: 8px 16px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white;">Establecer Meta</button>
                    </div>
                </div>
        </div>

        <div class="main-content">
                <div class="tabs">
                <button class="tab-btn active" data-tab="transactions">üí≥ Transacciones</button>
                <button class="tab-btn" data-tab="envelopes">üì¶ Presupuestos</button>
                <button class="tab-btn" data-tab="loans">üè¶ Pr√©stamos</button>
                <button class="tab-btn" data-tab="investments">üìà Inversiones</button>
                <button class="tab-btn" data-tab="charts">üìä An√°lisis</button>
            </div>

            <!-- Tab: Transacciones -->
            <div class="tab-content active" id="transactions-tab">
                <div class="form-section">
                    <h2>Nueva Transacci√≥n</h2>
                    <form id="transactionForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="transactionType">Tipo</label>
                                <select id="transactionType" required>
                                    <option value="income">Ingreso</option>
                                    <option value="expense">Gasto</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="transactionDate">Fecha</label>
                                <input type="date" id="transactionDate" required>
                            </div>
                            <div class="form-group">
                                <label for="transactionAmount">Monto</label>
                                <input type="number" id="transactionAmount" step="0.01" min="0" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="categoryGeneral">Categor√≠a General</label>
                                <select id="categoryGeneral" required>
                                    <option value="">Seleccionar...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="categorySpecific">Categor√≠a Espec√≠fica</label>
                                <select id="categorySpecific" required>
                                    <option value="">Seleccionar...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="envelope">Sobre (Opcional)</label>
                                <select id="envelope">
                                    <option value="">Ninguno</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="transactionDescription">Descripci√≥n</label>
                                <input type="text" id="transactionDescription" placeholder="Ej: Compra en supermercado">
                            </div>
                        </div>
                        <button type="submit" class="btn-primary">Agregar Transacci√≥n</button>
                    </form>
                </div>

                <div class="table-section">
                    <h2>Historial de Transacciones</h2>
                    <div class="table-controls">
                        <input type="text" id="searchInput" placeholder="üîç Buscar...">
                        <select id="filterCategory">
                            <option value="">Todas las categor√≠as</option>
                        </select>
                        <select id="filterMonth">
                            <option value="">Todos los meses</option>
                        </select>
                    </div>
                    <div class="table-container">
                        <table id="transactionsTable">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Tipo</th>
                                    <th>Categor√≠a</th>
                                    <th>Descripci√≥n</th>
                                    <th>Sobre</th>
                                    <th>Monto</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="transactionsBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Tab: Presupuestos -->
            <div class="tab-content" id="envelopes-tab">
                <div class="form-section">
                    <h2>Gestionar Presupuestos</h2>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                        <div>
                            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: var(--gray-900);">Presupuestos por Categor√≠a</h3>
                            <form id="budgetForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="budgetCategory">Categor√≠a</label>
                                        <select id="budgetCategory" required>
                                            <option value="">Seleccionar categor√≠a...</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="budgetAmount">Presupuesto Mensual (‚Ç¨)</label>
                                        <input type="number" id="budgetAmount" step="0.01" min="0" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="budgetMonth">Mes</label>
                                        <input type="month" id="budgetMonth" required>
                                    </div>
                                    <button type="submit" class="btn-primary" style="align-self: flex-end;">Establecer Presupuesto</button>
                                </div>
                            </form>
                        </div>
                        <div>
                            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: var(--gray-900);">Sobres (Presupuestos Flexibles)</h3>
                            <form id="envelopeForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="envelopeName">Nombre del Sobre</label>
                                        <input type="text" id="envelopeName" placeholder="Ej: Vacaciones" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="envelopeBudget">Presupuesto Mensual (‚Ç¨)</label>
                                        <input type="number" id="envelopeBudget" step="0.01" min="0" required>
                                    </div>
                                </div>
                                <button type="submit" class="btn-primary">Crear Sobre</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 32px;">
                    <h2 style="font-size: 20px; font-weight: 700; margin-bottom: 20px; color: var(--gray-900);">Presupuestos del Mes</h2>
                    <div id="budgetsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; margin-bottom: 32px;">
                    </div>
                    <h2 style="font-size: 20px; font-weight: 700; margin-bottom: 20px; color: var(--gray-900);">Sobres</h2>
                    <div class="envelopes-grid" id="envelopesGrid">
                    </div>
                </div>
            </div>

            <!-- Tab: Pr√©stamos -->
            <div class="tab-content" id="loans-tab">
                <div class="form-section">
                    <h2>Gestionar Pr√©stamos e Hipotecas</h2>
                    <form id="loanForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="loanName">Nombre del Pr√©stamo</label>
                                <input type="text" id="loanName" placeholder="Ej: Hipoteca vivienda" required>
                            </div>
                            <div class="form-group">
                                <label for="loanType">Tipo</label>
                                <select id="loanType" required>
                                    <option value="debt">Deuda (Debo)</option>
                                    <option value="credit">Cr√©dito (Me deben)</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="loanPrincipal">Monto Principal (‚Ç¨)</label>
                                <input type="number" id="loanPrincipal" step="0.01" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="loanInterestRate">Tasa de Inter√©s Anual (%)</label>
                                <input type="number" id="loanInterestRate" step="0.01" min="0" max="100" required>
                            </div>
                            <div class="form-group">
                                <label for="loanTAE">TAE - Tasa Anual Equivalente (%)</label>
                                <input type="number" id="loanTAE" step="0.01" min="0" max="100" placeholder="Opcional">
                                <small style="color: #666;">Incluye comisiones y gastos</small>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="loanStartDate">Fecha de Inicio</label>
                                <input type="date" id="loanStartDate" required>
                            </div>
                            <div class="form-group">
                                <label for="loanEndDate">Fecha de Fin</label>
                                <input type="date" id="loanEndDate" required>
                            </div>
                            <div class="form-group">
                                <label for="loanMonthlyPayment">Pago Mensual (‚Ç¨)</label>
                                <input type="number" id="loanMonthlyPayment" step="0.01" min="0" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="loanOpeningCommission">Comisi√≥n de Apertura (‚Ç¨)</label>
                                <input type="number" id="loanOpeningCommission" step="0.01" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label for="loanEarlyPaymentCommission">Comisi√≥n Amortizaci√≥n Anticipada (%)</label>
                                <input type="number" id="loanEarlyPaymentCommission" step="0.01" min="0" max="100" value="0">
                            </div>
                            <div class="form-group">
                                <label for="loanPaymentDay">D√≠a de Pago del Mes</label>
                                <input type="number" id="loanPaymentDay" min="1" max="31" value="1" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="loanDescription">Descripci√≥n (Opcional)</label>
                                <input type="text" id="loanDescription" placeholder="Ej: Hipoteca banco XYZ, cuenta 1234">
                            </div>
                        </div>
                        <button type="submit" class="btn-primary">Agregar Pr√©stamo</button>
                    </form>
                </div>
                <div class="loans-grid" id="loansGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; margin-top: 30px;">
                </div>
            </div>

            <!-- Tab: Inversiones -->
            <div class="tab-content" id="investments-tab">
                <div class="form-section">
                    <h2>Gestionar Inversiones</h2>
                    <form id="investmentForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="investmentName">Nombre de la Inversi√≥n</label>
                                <input type="text" id="investmentName" placeholder="Ej: Acciones Apple" required>
                            </div>
                            <div class="form-group">
                                <label for="investmentType">Tipo</label>
                                <select id="investmentType" required>
                                    <option value="stocks">Acciones</option>
                                    <option value="bonds">Bonos</option>
                                    <option value="crypto">Criptomonedas</option>
                                    <option value="funds">Fondos</option>
                                    <option value="real_estate">Inmuebles</option>
                                    <option value="other">Otros</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="investmentAmount">Monto Invertido (‚Ç¨)</label>
                                <input type="number" id="investmentAmount" step="0.01" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="investmentDate">Fecha de Inversi√≥n</label>
                                <input type="date" id="investmentDate" required>
                            </div>
                            <div class="form-group">
                                <label for="investmentCurrentValue">Valor Actual (‚Ç¨)</label>
                                <input type="number" id="investmentCurrentValue" step="0.01" min="0" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="investmentReturn">Rentabilidad (%)</label>
                                <input type="number" id="investmentReturn" step="0.01" placeholder="Se calcula autom√°ticamente" readonly>
                            </div>
                            <div class="form-group">
                                <label for="investmentProfit">Ganancia/P√©rdida (‚Ç¨)</label>
                                <input type="number" id="investmentProfit" step="0.01" placeholder="Se calcula autom√°ticamente" readonly>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="investmentDescription">Descripci√≥n (Opcional)</label>
                                <input type="text" id="investmentDescription" placeholder="Ej: Inversi√≥n a largo plazo">
                            </div>
                        </div>
                        <button type="submit" class="btn-primary">Agregar Inversi√≥n</button>
                    </form>
                </div>
                <div class="investments-grid" id="investmentsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 16px; margin-top: 24px;">
                </div>
            </div>

            <!-- Tab: An√°lisis -->
            <div class="tab-content" id="charts-tab">
                <div class="chart-controls" style="margin-bottom: 20px; padding: 15px; background: white; border-radius: 8px; display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                    <label style="font-weight: 600;">Per√≠odo:</label>
                    <select id="chartPeriod" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                        <option value="1">√öltimo mes</option>
                        <option value="3">√öltimos 3 meses</option>
                        <option value="6" selected>√öltimos 6 meses</option>
                        <option value="12">√öltimo a√±o</option>
                        <option value="24">√öltimos 2 a√±os</option>
                        <option value="all">Todo el historial</option>
                    </select>
                    <button id="addCustomCategoryBtn" class="btn-secondary" style="margin-left: auto;">‚ûï Agregar Categor√≠a Personalizada</button>
                </div>
                <div class="charts-container">
                    <div class="chart-card">
                        <h3>Evoluci√≥n de Ahorro</h3>
                        <canvas id="savingsChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Gastos por Categor√≠a</h3>
                        <canvas id="expensesChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Ingresos vs Gastos</h3>
                        <canvas id="incomeExpenseChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Distribuci√≥n de Gastos</h3>
                        <canvas id="distributionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cargar aplicaci√≥n JavaScript directamente -->
    <script src="/app.js"></script>
</body>
</html>

